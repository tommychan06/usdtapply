<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>USDT 支付主页</title>
<style>
  :root{--bg:#0f172a;--card:#0b1225;--muted:#94a3b8;--text:#e2e8f0;--pri:#3b82f6}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1020,#0f172a);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text)}
  .wrap{max-width:860px;margin:40px auto;padding:16px}
  .card{background:rgba(255,255,255,.04);backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:22px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:.2rem 0 1rem;font-size:24px}
  .row{display:flex;gap:16px;margin-bottom:16px}
  .col{flex:1;min-width:0}
  label{display:block;margin-bottom:8px;color:var(--muted);font-size:14px}
  input,select,textarea{width:100%;padding:12px 14px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:var(--text);border-radius:12px;outline:none;box-sizing:border-box}
  input:focus,select:focus,textarea:focus{border-color:var(--pri)}
  select{height:46px}
  input[type="number"],input[type="text"]{height:46px}
  .muted{color:var(--muted);font-size:13px}
  .channel-box{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:11px 12px;box-sizing:border-box;height:46px;display:flex;align-items:center}
  .radio-group{display:flex;gap:30px;width:100%}
  .radio-item{display:flex;align-items:center;gap:8px;cursor:pointer}
  .radio-item input[type="radio"]{width:18px;height:18px;accent-color:var(--pri);cursor:pointer;margin:0}
  .radio-item label{cursor:pointer;font-size:14px;margin:0}
  .actions{display:flex;gap:10px;justify-content:center;margin-top:20px}
  .btn{padding:12px 24px;border:none;border-radius:12px;cursor:pointer;font-size:16px}
  .btn.primary{background:var(--pri);color:#fff}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}
  .help{margin-top:10px;color:#93c5fd;font-size:13px}
  .err{margin-top:8px;color:#fda4af;font-size:13px}
  .success{margin-top:10px;padding:12px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:8px;color:#86efac;font-size:14px}
  footer{margin-top:18px;color:var(--muted);font-size:12px}
  .footer-section{margin-top:40px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08);text-align:center}
  .footer-links{display:flex;justify-content:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}
  .footer-links a{color:var(--muted);text-decoration:none;font-size:13px;transition:color .2s}
  .footer-links a:hover{color:var(--text)}
  .footer-info{color:var(--muted);font-size:12px;line-height:1.8}
  .footer-info span{margin:0 8px}
  .submit-tip{margin-top:15px;text-align:center;color:#fbbf24;font-size:14px;font-weight:500}
</style>
</head>
<body>
<div class="wrap">
  <h1 style="text-align:center;font-size:32px;margin-bottom:25px;color:var(--text);text-shadow:0 2px 10px rgba(0,0,0,.5);">易渠USDT支付平台</h1>
  <div class="card">
    <h1>USDT 授权/支付</h1>
    <div class="row">
      <div class="col">
        <label>支付项目</label>
        <select id="merchantSelect"></select>
        <label style="margin-top:15px;">支付通道 (USDT)</label>
        <div class="channel-box">
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" id="trc20" name="network" value="TRC-20" checked>
              <label for="trc20">TRC-20</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="erc20" name="network" value="ERC-20">
              <label for="erc20">ERC-20</label>
            </div>
          </div>
        </div>
      </div>
      <div class="col">
        <label>支付金额（USDT）</label>
        <input id="amount" type="number" step="0.01" min="0" placeholder="例如 19.99">
        <label style="margin-top:10px;">备注（可选）</label>
        <input id="memo" type="text" maxlength="64" placeholder="订单号 / 说明">
        <div id="error" class="err"></div>
        <div class="actions">
          <button class="btn primary" id="submitBtn">提交</button>
          <button class="btn primary" id="previewBtn">生成交易</button>
        </div>
        <div id="result"></div>
      </div>
    </div>
    <footer>选择支付通道后点击提交将跳转到对应的支付页面。</footer>
  </div>
  
  <div class="footer-section">
    <div class="footer-links">
      <a href="">关于我们</a>&nbsp;
      <a href="">服务条款</a>&nbsp;
      <a href="">隐私政策</a>&nbsp;
      <a href="">帮助中心</a>&nbsp;
      <a href="">联系客服</a>
    </div>
    <div class="footer-info">
      <div>© 2025 易渠支付平台 版权所有</div>
      <div>
        <span>京ICP备2024000001号-1</span>
        <span>|</span>
        <span>京公网安备11010802024000号</span>
      </div>
      <div>
        <span>营业执照</span>
        <span>|</span>
        <span>增值电信业务经营许可证：京B2-20240001</span>
      </div>
      <div style="margin-top:10px;">
        <span>客服邮箱：tommyc121992@gmail.com</span>
      </div>
      <div style="margin-top:10px;font-size:11px;">
        风险提示：数字货币交易具有一定风险，请谨慎操作
      </div>
    </div>
  </div>
</div>

<script>
// ===== 1) 商户配置 =====
const MERCHANTS = [
  { id: "shopA", name: "担保交易" },
  { id: "shopB", name: "购买数据" },
  { id: "shopC", name: "定制服务" },
  { id: "shopD", name: "其他" },
];

// 默认选中的商户
let selectedId = MERCHANTS[0].id;

// ===== 新增：URL参数自动填充功能 =====
function getUrlParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    merchant: params.get('merchant'),
    amount: params.get('amount'),
    memo: params.get('memo')
  };
}

function autoFillFromUrl() {
  const params = getUrlParams();
  
  // 如果有merchant参数，设置支付项目
  if (params.merchant) {
    const merchantId = MERCHANTS.find(m => m.name === params.merchant)?.id;
    if (merchantId) {
      selectedId = merchantId;
    }
  }
  
  // 如果有amount参数，设置支付金额
  if (params.amount) {
    const amountInput = document.getElementById('amount');
    if (amountInput) {
      amountInput.value = params.amount;
    }
  }
  
  // 如果有memo参数，设置备注
  if (params.memo) {
    const memoInput = document.getElementById('memo');
    if (memoInput) {
      memoInput.value = decodeURIComponent(params.memo);
    }
  }
}

// ===== 2) 渲染商户下拉 =====
const sel = document.getElementById('merchantSelect');
function renderMerchants(){
  sel.innerHTML = '';
  MERCHANTS.forEach(m=>{
    const opt = document.createElement('option');
    opt.value = m.id; 
    opt.textContent = m.name;
    if (m.id === selectedId) opt.selected = true;
    sel.appendChild(opt);
  });
}

// ===== 3) 获取表单数据 =====
function getFormData(){
  const amt = document.getElementById('amount').value.trim();
  const memo = document.getElementById('memo').value.trim();
  const merchant = MERCHANTS.find(x=>x.id===selectedId);
  const network = document.querySelector('input[name="network"]:checked').value;
  
  // 生成交易流水号
  const timestamp = new Date();
  const year = timestamp.getFullYear();
  const month = String(timestamp.getMonth() + 1).padStart(2, '0');
  const day = String(timestamp.getDate()).padStart(2, '0');
  const hours = String(timestamp.getHours()).padStart(2, '0');
  const minutes = String(timestamp.getMinutes()).padStart(2, '0');
  const seconds = String(timestamp.getSeconds()).padStart(2, '0');
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  const transactionId = `USDT${year}${month}${day}${hours}${minutes}${seconds}${random}`;
  
  return {
    transactionId: transactionId,
    merchant: merchant ? merchant.name : '',
    merchantId: selectedId,
    network: network,
    amount: amt,
    memo: memo,
    timestamp: timestamp.toLocaleString('zh-CN')
  };
}

// ===== 4) 校验 =====
const errEl = document.getElementById('error');
function validate(){
  const amtStr = document.getElementById('amount').value.trim();
  if (!amtStr){ errEl.textContent = '请输入金额'; return false; }
  const amt = Number(amtStr);
  if (Number.isNaN(amt) || amt <= 0){ errEl.textContent = '金额须为大于 0 的数字'; return false; }
  // 保留两位小数
  if (!/^\d+(\.\d{1,2})?$/.test(amtStr)){ errEl.textContent = '金额最多保留两位小数'; return false; }
  errEl.textContent = '';
  return true;
}

// ===== 5) 按钮功能 =====
const resultEl = document.getElementById('result');

// 提交按钮 - 根据选择的通道跳转到不同页面
document.getElementById('submitBtn').onclick = ()=>{
  if (!validate()) return;
  
  // 获取表单数据
  const data = getFormData();
  
  // 构建URL参数
  const params = new URLSearchParams({
    transactionId: data.transactionId,
    merchant: data.merchant,
    amount: data.amount,
    network: data.network,
    memo: data.memo || ''
  });
  
  // 根据不同通道跳转到不同页面（带参数）
  if (data.network === 'TRC-20') {
    window.location.href = `./trcusdt.html?${params.toString()}`;
  } else if (data.network === 'ERC-20') {
    window.location.href = `./ercusdt.html?${params.toString()}`;
  }
};

// 查看数据按钮
document.getElementById('previewBtn').onclick = ()=>{
  if (!validate()) return;
  const data = getFormData();
  
  // 显示当前表单数据
  resultEl.innerHTML = `<div class="help" style="margin-top:10px;">
    <strong>当前交易：</strong><br>
    交易流水号：<span style="color:#3b82f6;font-weight:bold">******</span><span style="color:#22c55e;">（已生成）</span><br>
    项目：${data.merchant}<br>
    支付通道：${data.network}<br>
    金额：${data.amount} USDT<br>
    备注：${data.memo || '无'}<br>
    时间：${data.timestamp}
  </div>
  <div class="submit-tip">请点击提交完成支付</div>`;
};

// ===== 页面加载时执行 =====
document.addEventListener('DOMContentLoaded', function() {
  // 先执行URL参数自动填充
  autoFillFromUrl();
  // 然后渲染商户下拉框
  renderMerchants();
  // 绑定下拉框变化事件
  sel.onchange = e => { selectedId = e.target.value; };
});
</script>
</body>
</html>