<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>易渠SafePay - 智能USDT担保交易平台</title>
<style>
  :root{
    --bg-dark:#0a0e1a;
    --bg-card:#131825;
    --bg-hover:#1a2235;
    --border:#2a3245;
    --text-primary:#ffffff;
    --text-secondary:#94a3b8;
    --text-muted:#64748b;
    --primary:#3b82f6;
    --primary-dark:#2563eb;
    --success:#10b981;
    --warning:#f59e0b;
    --danger:#ef4444;
    --info:#06b6d4;
  }
  
  *{margin:0;padding:0;box-sizing:border-box}
  
  body{
    background:var(--bg-dark);
    background-image:radial-gradient(circle at 20% 80%, #1e40af15 0%, transparent 50%),
                     radial-gradient(circle at 80% 20%, #7c3aed15 0%, transparent 50%),
                     radial-gradient(circle at 40% 40%, #10b98115 0%, transparent 50%);
    font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
    color:var(--text-primary);
    min-height:100vh;
  }
  
  .container{
    max-width:1280px;
    margin:0 auto;
    padding:24px;
  }
  
  .navbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 0;
    margin-bottom:32px;
    border-bottom:1px solid var(--border);
  }
  
  .logo{
    display:flex;
    align-items:center;
    gap:12px;
    font-size:24px;
    font-weight:700;
  }
  
  .logo-icon{
    width:40px;
    height:40px;
    background:linear-gradient(135deg, var(--primary), var(--info));
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  
  .nav-right{
    display:flex;
    align-items:center;
    gap:24px;
  }
  
  .user-info{
    display:flex;
    align-items:center;
    gap:12px;
    padding:8px 16px;
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:12px;
  }
  
  .reputation-score{
    display:flex;
    align-items:center;
    gap:4px;
    padding:4px 8px;
    background:rgba(16,185,129,0.1);
    border-radius:6px;
    font-size:13px;
    color:var(--success);
  }
  
  .kyc-badge{
    padding:4px 8px;
    background:rgba(59,130,246,0.1);
    border:1px solid rgba(59,130,246,0.3);
    border-radius:6px;
    font-size:11px;
    color:var(--primary);
    font-weight:600;
  }
  
  .user-address-display{
    font-family:monospace;
    font-size:14px;
    color:var(--primary);
  }
  
  .login-card{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:20px;
    padding:32px;
    margin-bottom:32px;
    box-shadow:0 10px 30px rgba(0,0,0,0.2);
  }
  
  .login-card-header{
    display:flex;
    align-items:center;
    gap:16px;
    margin-bottom:24px;
  }
  
  .login-card-icon{
    width:56px;
    height:56px;
    background:linear-gradient(135deg, var(--primary), var(--info));
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
  }
  
  .login-card-title{
    flex:1;
  }
  
  .login-card-title h2{
    font-size:22px;
    font-weight:700;
    margin-bottom:4px;
  }
  
  .login-card-subtitle{
    font-size:14px;
    color:var(--text-secondary);
  }
  
  .login-status-badge{
    padding:8px 16px;
    background:rgba(16,185,129,0.1);
    border:1px solid rgba(16,185,129,0.3);
    border-radius:10px;
    color:var(--success);
    font-weight:600;
    font-size:14px;
    display:none;
  }
  
  .login-status-badge.show{
    display:block;
  }
  
  .login-form-container{
    display:flex;
    gap:16px;
    align-items:center;
  }
  
  .login-input-wrapper{
    flex:1;
    position:relative;
  }
  
  .login-input-field{
    width:100%;
    padding:14px 16px 14px 48px;
    background:var(--bg-hover);
    border:2px solid var(--border);
    border-radius:12px;
    color:var(--text-primary);
    font-size:15px;
    font-family:monospace;
    transition:all 0.3s;
  }
  
  .login-input-icon{
    position:absolute;
    left:16px;
    top:50%;
    transform:translateY(-50%);
    color:var(--text-muted);
    font-size:18px;
  }
  
  .login-input-field:focus{
    outline:none;
    border-color:var(--primary);
    background:rgba(59,130,246,0.05);
  }
  
  .login-input-field:disabled{
    background:rgba(16,185,129,0.05);
    border-color:rgba(16,185,129,0.3);
    color:var(--success);
    cursor:not-allowed;
  }
  
  .login-buttons{
    display:flex;
    gap:12px;
  }
  
  .login-btn{
    padding:14px 28px;
    border:none;
    border-radius:12px;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    display:inline-flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
  }
  
  .login-btn.primary{
    background:linear-gradient(135deg, var(--primary), var(--primary-dark));
    color:white;
  }
  
  .login-btn.primary:hover:not(:disabled){
    transform:translateY(-2px);
    box-shadow:0 8px 24px rgba(59,130,246,0.3);
  }
  
  .login-btn.secondary{
    background:linear-gradient(135deg, var(--warning), #dc2626);
    color:white;
  }
  
  .login-btn.secondary:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 24px rgba(245,158,11,0.3);
  }
  
  .login-btn:disabled{
    opacity:0.5;
    cursor:not-allowed;
  }
  
  .login-tips{
    margin-top:20px;
    padding:16px;
    background:rgba(59,130,246,0.05);
    border:1px solid rgba(59,130,246,0.2);
    border-radius:12px;
    font-size:13px;
    line-height:1.8;
    color:var(--text-secondary);
  }
  
  .main-grid{
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:24px;
  }
  
  .card{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:20px;
    padding:28px;
  }
  
  .card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
  }
  
  .card-title{
    font-size:20px;
    font-weight:600;
  }
  
  .role-selector{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
    margin-bottom:24px;
  }
  
  .role-option{
    padding:16px;
    background:var(--bg-hover);
    border:2px solid var(--border);
    border-radius:12px;
    cursor:pointer;
    transition:all 0.3s;
    text-align:center;
  }
  
  .role-option:hover{
    border-color:var(--primary);
    background:rgba(59,130,246,0.05);
  }
  
  .role-option.selected{
    border-color:var(--primary);
    background:rgba(59,130,246,0.1);
  }
  
  .role-icon{
    font-size:28px;
    margin-bottom:8px;
  }
  
  .role-name{
    font-weight:600;
    margin-bottom:4px;
  }
  
  .role-desc{
    font-size:12px;
    color:var(--text-muted);
  }
  
  .form-group{
    margin-bottom:20px;
  }
  
  .form-row{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
  }
  
  label{
    display:block;
    font-size:13px;
    color:var(--text-secondary);
    margin-bottom:8px;
    font-weight:500;
  }
  
  .required{
    color:var(--danger);
  }
  
  input, textarea{
    width:100%;
    padding:12px 14px;
    background:var(--bg-hover);
    border:1px solid var(--border);
    border-radius:10px;
    color:var(--text-primary);
    font-size:14px;
    transition:all 0.3s;
  }
  
  input:focus, textarea:focus{
    outline:none;
    border-color:var(--primary);
    background:rgba(59,130,246,0.05);
  }
  
  select{
    width:100%;
    padding:12px 40px 12px 14px;
    background-color:var(--bg-hover);
    border:1px solid var(--border);
    border-radius:10px;
    color:var(--text-primary);
    font-size:14px;
    transition:all 0.3s;
    cursor:pointer;
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat:no-repeat;
    background-position:right 12px center;
    background-size:20px;
  }
  
  select:focus{
    outline:none;
    border-color:var(--primary);
    background-color:rgba(59,130,246,0.05);
  }
  
  select option{
    background-color:var(--bg-card);
    color:var(--text-primary);
    padding:8px;
    font-size:14px;
  }
  
  select option:hover{
    background-color:var(--bg-hover);
  }
  
  select option:checked{
    background:linear-gradient(to right, var(--primary), var(--primary));
    color:white;
  }
  
  @-moz-document url-prefix(){
    select{
      background-color:var(--bg-hover) !important;
      color:var(--text-primary) !important;
    }
    select option{
      background-color:var(--bg-card) !important;
      color:var(--text-primary) !important;
    }
  }
  
  @media screen and (-webkit-min-device-pixel-ratio:0){
    select option{
      background-color:#131825 !important;
      color:#ffffff !important;
    }
  }
  
  textarea{
    min-height:100px;
    resize:vertical;
  }
  
  .risk-assessment{
    background:var(--bg-hover);
    border-radius:12px;
    padding:16px;
    margin-bottom:20px;
  }
  
  .risk-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }
  
  .risk-title{
    font-size:14px;
    font-weight:600;
  }
  
  .risk-score{
    display:flex;
    align-items:center;
    gap:8px;
  }
  
  .risk-value{
    font-size:20px;
    font-weight:700;
  }
  
  .risk-level{
    padding:4px 8px;
    border-radius:6px;
    font-size:11px;
    font-weight:600;
  }
  
  .risk-low{
    background:rgba(16,185,129,0.1);
    color:var(--success);
  }
  
  .risk-medium{
    background:rgba(245,158,11,0.1);
    color:var(--warning);
  }
  
  .risk-high{
    background:rgba(239,68,68,0.1);
    color:var(--danger);
  }
  
  .risk-factors{
    display:grid;
    gap:8px;
  }
  
  .risk-factor{
    display:flex;
    justify-content:space-between;
    font-size:12px;
    padding:6px 0;
    border-bottom:1px solid var(--border);
  }
  
  .risk-factor:last-child{
    border-bottom:none;
  }
  
  .factor-label{
    color:var(--text-muted);
  }
  
  .factor-value{
    font-weight:500;
  }
  
  .fee-breakdown{
    background:linear-gradient(135deg, rgba(59,130,246,0.05), rgba(6,182,212,0.05));
    border:1px solid rgba(59,130,246,0.2);
    border-radius:12px;
    padding:16px;
    margin-bottom:20px;
  }
  
  .fee-row{
    display:flex;
    justify-content:space-between;
    padding:8px 0;
    font-size:14px;
  }
  
  .fee-row.total{
    border-top:1px solid rgba(59,130,246,0.2);
    margin-top:8px;
    padding-top:12px;
    font-weight:600;
    font-size:16px;
  }
  
  .fee-label{
    color:var(--text-secondary);
  }
  
  .fee-value{
    color:var(--text-primary);
    font-family:'Courier New', monospace;
  }
  
  .limit-info{
    background:rgba(245,158,11,0.05);
    border:1px solid rgba(245,158,11,0.2);
    border-radius:10px;
    padding:12px;
    margin-bottom:20px;
    display:flex;
    align-items:center;
    gap:12px;
  }
  
  .limit-icon{
    font-size:20px;
  }
  
  .limit-text{
    flex:1;
    font-size:13px;
    color:var(--text-secondary);
  }
  
  .limit-values{
    display:flex;
    gap:16px;
    font-size:12px;
  }
  
  .limit-item{
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  
  .limit-label{
    color:var(--text-muted);
    margin-bottom:4px;
  }
  
  .limit-amount{
    color:var(--warning);
    font-weight:600;
  }
  
  .btn{
    padding:12px 24px;
    border:none;
    border-radius:10px;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    display:inline-flex;
    align-items:center;
    gap:8px;
  }
  
  .btn:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(0,0,0,0.3);
  }
  
  .btn-primary{
    background:linear-gradient(135deg, var(--primary), var(--primary-dark));
    color:white;
  }
  
  .btn-secondary{
    background:var(--bg-hover);
    color:var(--text-primary);
    border:1px solid var(--border);
  }
  
  .btn-group{
    display:flex;
    gap:12px;
    justify-content:flex-end;
    margin-top:24px;
  }
  
  .security-features{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:20px;
    padding:28px;
  }
  
  .feature-list{
    display:grid;
    gap:16px;
  }
  
  .feature-item{
    display:flex;
    align-items:flex-start;
    gap:12px;
  }
  
  .feature-icon{
    width:32px;
    height:32px;
    background:rgba(16,185,129,0.1);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-shrink:0;
  }
  
  .feature-content{
    flex:1;
  }
  
  .feature-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:4px;
  }
  
  .feature-desc{
    font-size:12px;
    color:var(--text-muted);
    line-height:1.5;
  }
  
  .live-transactions{
    margin-top:24px;
  }
  
  .transaction-item{
    display:flex;
    align-items:center;
    padding:12px;
    background:var(--bg-hover);
    border-radius:10px;
    margin-bottom:8px;
    font-size:13px;
  }
  
  .transaction-status{
    width:8px;
    height:8px;
    border-radius:50%;
    margin-right:12px;
    flex-shrink:0;
  }
  
  .status-active{
    background:var(--success);
    animation:pulse 2s infinite;
  }
  
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(16,185,129,0.4)}
    70%{box-shadow:0 0 0 10px rgba(16,185,129,0)}
    100%{box-shadow:0 0 0 0 rgba(16,185,129,0)}
  }
  
  .transaction-info{
    flex:1;
  }
  
  .transaction-id{
    font-family:'Courier New', monospace;
    color:var(--text-muted);
    font-size:11px;
  }
  
  .transaction-amount{
    font-weight:600;
    color:var(--primary);
  }
  
  /* ========== 统一的弹窗样式 ========== */
  
  /* 弹窗遮罩层 */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeInModal 0.3s ease;
  }
  
  /* 弹窗容器 */
  .modal-container {
    background: var(--bg-card);
    background-image: radial-gradient(circle at top left, rgba(59,130,246,0.05), transparent),
                      radial-gradient(circle at bottom right, rgba(16,185,129,0.05), transparent);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 32px;
    max-width: 90%;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 100px rgba(59, 130, 246, 0.1);
    animation: slideUpModal 0.3s ease;
  }
  
  /* 弹窗大小变体 */
  .modal-container.small {
    max-width: 400px;
  }
  
  .modal-container.medium {
    max-width: 600px;
  }
  
  .modal-container.large {
    max-width: 800px;
  }
  
  /* 弹窗头部 */
  .modal-header {
    text-align: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border);
  }
  
  .modal-icon {
    font-size: 48px;
    margin-bottom: 16px;
    display: block;
  }
  
  .modal-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
  }
  
  .modal-subtitle {
    font-size: 13px;
    color: var(--text-muted);
  }
  
  /* 弹窗内容 */
  .modal-body {
    margin-bottom: 24px;
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-line;
  }
  
  .modal-info-section {
    margin-bottom: 20px;
    padding: 16px;
    background: var(--bg-hover);
    border-radius: 12px;
  }
  
  .modal-info-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text-secondary);
  }
  
  .modal-info-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 13px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  
  .modal-info-row:last-child {
    border-bottom: none;
  }
  
  /* 弹窗动作按钮 */
  .modal-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }
  
  .modal-btn {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    outline: none;
  }
  
  .modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  
  .modal-btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .modal-btn-primary:hover {
    background: var(--primary-dark);
  }
  
  .modal-btn-secondary {
    background: var(--bg-hover);
    color: var(--text-primary);
    border: 1px solid var(--border);
  }
  
  .modal-btn-secondary:hover {
    border-color: var(--primary);
    background: rgba(59, 130, 246, 0.1);
  }
  
  .modal-btn-success {
    background: var(--success);
    color: white;
  }
  
  .modal-btn-warning {
    background: var(--warning);
    color: white;
  }
  
  .modal-btn-danger {
    background: var(--danger);
    color: white;
  }
  
  /* Toast 通知样式 */
  .toast {
    position: fixed;
    top: 24px;
    right: 24px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    z-index: 2000;
    animation: slideInRightToast 0.3s ease;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    max-width: 400px;
  }
  
  .toast-icon {
    font-size: 20px;
  }
  
  .toast-message {
    flex: 1;
    color: var(--text-primary);
  }
  
  .toast-close {
    cursor: pointer;
    opacity: 0.5;
    transition: opacity 0.3s;
  }
  
  .toast-close:hover {
    opacity: 1;
  }
  
  .toast.success {
    border-color: var(--success);
    background: linear-gradient(to right, rgba(16, 185, 129, 0.1), var(--bg-card));
  }
  
  .toast.warning {
    border-color: var(--warning);
    background: linear-gradient(to right, rgba(245, 158, 11, 0.1), var(--bg-card));
  }
  
  .toast.error {
    border-color: var(--danger);
    background: linear-gradient(to right, rgba(239, 68, 68, 0.1), var(--bg-card));
  }
  
  .toast.info {
    border-color: var(--info);
    background: linear-gradient(to right, rgba(6, 182, 212, 0.1), var(--bg-card));
  }
  
  /* 动画 */
  @keyframes fadeInModal {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideUpModal {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  @keyframes slideInRightToast {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @media (max-width:968px){
    .main-grid{
      grid-template-columns:1fr;
    }
    .login-form-container{
      flex-direction:column;
      align-items:stretch;
    }
    .login-buttons{
      width:100%;
    }
    .login-btn{
      flex:1;
    }
    .modal-container {
      max-width: 95%;
      padding: 24px;
    }
  }
  
  @media (max-width:640px){
    .form-row{
      grid-template-columns:1fr;
    }
    .role-selector{
      grid-template-columns:1fr;
    }
    .nav-right{
      flex-direction:column;
      gap:12px;
    }
    .login-card-header{
      flex-direction:column;
      text-align:center;
    }
    .modal-container {
      padding: 20px;
    }
    .modal-actions {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<div class="container">
  <!-- 顶部导航栏 -->
  <nav class="navbar">
    <div class="logo">
      <div class="logo-icon">🔐</div>
      <span>易渠SafePay</span>
    </div>
    <div class="nav-right">
      <div class="user-info">
        <div class="reputation-score">
          <span>⭐</span>
          <span>信誉分: <span id="userScore">--</span></span>
        </div>
        <span class="kyc-badge">KYC L<span id="kycLevel">-</span></span>
        <span class="user-address-display">用户: <span id="userAddressDisplay">未登录</span></span>
      </div>
    </div>
  </nav>
  
  <!-- 登录卡片 -->
  <div class="login-card">
    <div class="login-card-header">
      <div class="login-card-icon">💼</div>
      <div class="login-card-title">
        <h2>钱包地址登录</h2>
        <p class="login-card-subtitle">输入您的USDT钱包地址以开始使用</p>
      </div>
      <div class="login-status-badge" id="loginStatusBadge">
        ✓ 已登录
      </div>
    </div>
    
    <div class="login-form-container">
      <div class="login-input-wrapper">
        <span class="login-input-icon">💳</span>
        <input type="text" 
               id="walletAddress" 
               class="login-input-field" 
               placeholder="请输入USDT钱包地址 (TRC20: T开头34位 / ERC20/BEP20: 0x开头42位)">
      </div>
      <div class="login-buttons">
        <button class="login-btn primary" id="loginBtn" onclick="handleLogin()">
          <span>🔐</span>
          <span>登入</span>
        </button>
        <button class="login-btn secondary" id="resetBtn" onclick="handleReset()">
          <span>🔄</span>
          <span>重新登入</span>
        </button>
      </div>
    </div>
    
    <div class="login-tips">
      <strong>💡 提示：</strong>
      • 支持 TRC-20 (波场，T开头34位)、ERC-20 (以太坊，0x开头42位)、BEP-20 (币安智能链，0x开头42位) 网络钱包地址<br>
      • 无需私钥或助记词，仅使用公开地址<br>
      • 您的资产始终在您的钱包中，平台仅提供担保服务
    </div>
  </div>
  
  <!-- 主内容区域 -->
  <div class="main-grid">
    <!-- 左侧主要内容 -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">创建智能担保交易</h2>
        <span style="padding:6px 12px;background:rgba(16,185,129,0.1);color:var(--success);border-radius:20px;font-size:12px;font-weight:600;">
          安全模式启用
        </span>
      </div>
      
      <!-- 角色选择 -->
      <div class="role-selector">
        <div class="role-option selected" onclick="selectRole('buyer', this)">
          <div class="role-icon">🛒</div>
          <div class="role-name">我是买方</div>
          <div class="role-desc">购买商品或服务</div>
        </div>
        <div class="role-option" onclick="selectRole('seller', this)">
          <div class="role-icon">💼</div>
          <div class="role-name">我是卖方</div>
          <div class="role-desc">出售商品或服务</div>
        </div>
      </div>
      
      <!-- 交易表单 -->
      <form id="escrowForm">
        <div class="form-group">
          <label>对方钱包地址 <span class="required">*</span></label>
          <input type="text" id="counterpartyAddress" placeholder="输入对方钱包地址 (TRC20: T开头 / ERC20/BEP20: 0x开头)" onblur="checkAddress(this.value)">
          <div id="addressWarning" style="display:none;margin-top:8px;padding:8px;background:rgba(239,68,68,0.1);border-radius:6px;font-size:12px;color:var(--danger);">
            ⚠️ 该地址存在风险记录
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>交易金额 (USDT) <span class="required">*</span></label>
            <input type="number" id="amount" step="0.01" min="10" placeholder="最低 10 USDT" oninput="updateRiskAssessment()">
          </div>
          <div class="form-group">
            <label>选择网络 <span class="required">*</span></label>
            <select id="network" onchange="updateFees()">
              <option value="TRC20">TRC-20 (推荐)</option>
              <option value="ERC20">ERC-20</option>
              <option value="BEP20">BEP-20</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>托管期限 <span class="required">*</span></label>
            <select id="escrowPeriod">
              <option value="24">24小时 - 快速交易</option>
              <option value="72" selected>3天 - 标准交易</option>
              <option value="168">7天 - 大额交易</option>
              <option value="360">15天 - 定制交易</option>
            </select>
          </div>
          <div class="form-group">
            <label>交易类型</label>
            <select id="transactionType" onchange="updateRiskAssessment()">
              <option value="goods">实物商品</option>
              <option value="digital">数字商品</option>
              <option value="service">服务类</option>
              <option value="other">其他</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label>交易描述 <span class="required">*</span></label>
          <textarea id="description" placeholder="详细描述交易内容，便于争议处理（至少30字）" minlength="30"></textarea>
        </div>
        
        <!-- 风险评估 -->
        <div class="risk-assessment">
          <div class="risk-header">
            <span class="risk-title">🛡️ 风险评估</span>
            <div class="risk-score">
              <span class="risk-value" id="riskScore">25</span>
              <span class="risk-level risk-low" id="riskLevel">低风险</span>
            </div>
          </div>
          <div class="risk-factors">
            <div class="risk-factor">
              <span class="factor-label">对方信誉</span>
              <span class="factor-value" id="counterpartyRep">待验证</span>
            </div>
            <div class="risk-factor">
              <span class="factor-label">交易金额</span>
              <span class="factor-value" id="amountRisk">正常</span>
            </div>
            <div class="risk-factor">
              <span class="factor-label">交易频率</span>
              <span class="factor-value">正常</span>
            </div>
            <div class="risk-factor">
              <span class="factor-label">地址风险</span>
              <span class="factor-value" id="addressRisk">待检测</span>
            </div>
          </div>
        </div>
        
        <!-- 限额提示 -->
        <div class="limit-info">
          <span class="limit-icon">⚠️</span>
          <div class="limit-text">
            您的当前交易限额（基于KYC等级和信誉分）
          </div>
          <div class="limit-values">
            <div class="limit-item">
              <span class="limit-label">单笔</span>
              <span class="limit-amount">$150,000</span>
            </div>
            <div class="limit-item">
              <span class="limit-label">每日</span>
              <span class="limit-amount">$1,000,000</span>
            </div>
            <div class="limit-item">
              <span class="limit-label">每月</span>
              <span class="limit-amount">$50,000,000</span>
            </div>
          </div>
        </div>
        
        <!-- 费用明细 -->
        <div class="fee-breakdown">
          <div class="fee-row">
            <span class="fee-label">交易金额</span>
            <span class="fee-value" id="feeAmount">0.00 USDT</span>
          </div>
          <div class="fee-row">
            <span class="fee-label">平台服务费 (0.5%-1%)</span>
            <span class="fee-value" id="feeService">0.00 USDT</span>
          </div>
          <div class="fee-row">
            <span class="fee-label">网络手续费（预估）</span>
            <span class="fee-value" id="feeNetwork">1.00 USDT</span>
          </div>
          <div class="fee-row">
            <span class="fee-label">风险保证金</span>
            <span class="fee-value" id="feeDeposit">0.00 USDT</span>
          </div>
          <div class="fee-row total">
            <span class="fee-label">需支付总额</span>
            <span class="fee-value" id="feeTotal">0.00 USDT</span>
          </div>
        </div>
        
        <div class="btn-group">
          <button type="button" class="btn btn-secondary" onclick="saveDraft()">
            💾 保存草稿
          </button>
          <button type="submit" class="btn btn-primary">
            🚀 创建担保交易
          </button>
        </div>
      </form>
    </div>
    
    <!-- 右侧信息 -->
    <div>
      <!-- 安全特性 -->
      <div class="security-features">
        <h3 style="font-size:18px;margin-bottom:20px;">🔒 安全保障</h3>
        <div class="feature-list">
          <div class="feature-item">
            <div class="feature-icon">✓</div>
            <div class="feature-content">
              <div class="feature-title">智能合约托管</div>
              <div class="feature-desc">资金锁定在智能合约，任何一方无法单独提取</div>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">✓</div>
            <div class="feature-content">
              <div class="feature-title">链上验证</div>
              <div class="feature-desc">所有交易都经过区块链验证，确保真实性</div>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">✓</div>
            <div class="feature-content">
              <div class="feature-title">争议仲裁</div>
              <div class="feature-desc">专业团队介入，基于证据链公正裁决</div>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">✓</div>
            <div class="feature-content">
              <div class="feature-title">时效保护</div>
              <div class="feature-desc">超时自动处理，避免资金长期冻结</div>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">✓</div>
            <div class="feature-content">
              <div class="feature-title">信誉系统</div>
              <div class="feature-desc">基于历史交易的动态信誉评分机制</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 实时交易 -->
      <div class="card live-transactions">
        <h3 style="font-size:16px;margin-bottom:16px;">📊 实时交易动态</h3>
        <div id="liveTransactions">
          <!-- 动态交易列表 -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 全局变量
let currentRole = 'buyer';
let riskScore = 25;
let currentUserAddress = '';
let isLoggedIn = false;

// ========== 统一的弹窗系统 ==========

// 显示自定义弹窗
function showModal(options) {
  const {
    icon = '',
    title = '提示',
    subtitle = '',
    content = '',
    type = 'info',
    size = 'small',
    buttons = [
      { text: '确定', type: 'primary', action: () => closeModal() }
    ],
    onClose = null
  } = options;
  
  const iconMap = {
    success: '✅',
    warning: '⚠️',
    error: '❌',
    info: 'ℹ️',
    question: '❓'
  };
  
  const modalHTML = `
    <div id="customModal" class="modal-overlay">
      <div class="modal-container ${size}">
        ${icon || iconMap[type] ? `
          <div class="modal-header">
            <span class="modal-icon">${icon || iconMap[type]}</span>
            <div class="modal-title">${title}</div>
            ${subtitle ? `<div class="modal-subtitle">${subtitle}</div>` : ''}
          </div>
        ` : `
          <div class="modal-header">
            <div class="modal-title">${title}</div>
            ${subtitle ? `<div class="modal-subtitle">${subtitle}</div>` : ''}
          </div>
        `}
        
        ${content ? `<div class="modal-body">${content}</div>` : ''}
        
        <div class="modal-actions">
          ${buttons.map((btn, index) => `
            <button class="modal-btn modal-btn-${btn.type || 'secondary'}" 
                    onclick="handleModalAction(${index})">
              ${btn.text}
            </button>
          `).join('')}
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHTML);
  
  // 保存按钮动作
  window.modalButtons = buttons;
  window.modalOnClose = onClose;
}

// 处理弹窗按钮动作
function handleModalAction(index) {
  const button = window.modalButtons[index];
  if (button.action) {
    button.action();
  }
  if (!button.preventClose) {
    closeModal();
  }
}

// 关闭弹窗
function closeModal() {
  const modal = document.getElementById('customModal');
  if (modal) {
    modal.remove();
    if (window.modalOnClose) {
      window.modalOnClose();
    }
  }
}

// 显示 Toast 通知
function showToast(message, type = 'info', duration = 3000) {
  const iconMap = {
    success: '✅',
    warning: '⚠️',
    error: '❌',
    info: 'ℹ️'
  };
  
  const toastHTML = `
    <div class="toast ${type}" id="toast-${Date.now()}">
      <span class="toast-icon">${iconMap[type]}</span>
      <span class="toast-message">${message}</span>
      <span class="toast-close" onclick="this.parentElement.remove()">✕</span>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', toastHTML);
  
  const toast = document.body.lastElementChild;
  setTimeout(() => {
    if (toast && toast.parentElement) {
      toast.remove();
    }
  }, duration);
}

// ========== 业务逻辑 ==========

// 页面加载时初始化
window.addEventListener('DOMContentLoaded', function() {
  // 初始化
  document.getElementById('walletAddress').value = '';
  
  // 监听回车键
  document.getElementById('walletAddress').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !isLoggedIn) {
      handleLogin();
    }
  });
  
  // 初始化表单提交
  document.getElementById('escrowForm').addEventListener('submit', handleFormSubmit);
  
  // 初始化其他功能
  updateFees();
  startLiveUpdates();
  initializeLiveTransactions();
});

// 验证钱包地址格式
function isValidWalletAddress(address) {
  const trc20Pattern = /^T[A-Za-z0-9]{33}$/;
  const erc20Pattern = /^0x[a-fA-F0-9]{40}$/;
  return trc20Pattern.test(address) || erc20Pattern.test(address);
}

// 检测地址类型
function detectAddressType(address) {
  if (address.startsWith('T') && address.length === 34) {
    return 'TRC-20';
  } else if (address.startsWith('0x') && address.length === 42) {
    return 'ERC-20/BEP-20';
  }
  return 'Unknown';
}

// 登入功能
function handleLogin() {
  const addressInput = document.getElementById('walletAddress');
  const address = addressInput.value.trim();
  
  if (!address) {
    showModal({
      type: 'warning',
      title: '请输入钱包地址',
      content: '请在输入框中填写您的USDT钱包地址',
      buttons: [
        { 
          text: '确定', 
          type: 'primary',
          action: () => {
            document.getElementById('walletAddress').focus();
          }
        }
      ]
    });
    return;
  }
  
  if (!isValidWalletAddress(address)) {
    showModal({
      type: 'error',
      title: '钱包地址格式错误',
      content: `支持的钱包地址格式：

• TRC-20 (波场): 以T开头，34位
  示例: TN8Rf5PbEXe4XZDGt5H7dQBWoAMphDpg8K

• ERC-20 (以太坊): 以0x开头，42位
  示例: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb4

• BEP-20 (币安链): 以0x开头，42位
  示例: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb4

请检查您的钱包地址格式是否正确！`,
      size: 'medium',
      buttons: [
        { text: '重新输入', type: 'primary' }
      ]
    });
    return;
  }
  
  const addressType = detectAddressType(address);
  console.log('钱包地址类型:', addressType);
  
  currentUserAddress = address;
  isLoggedIn = true;
  
  addressInput.disabled = true;
  document.getElementById('loginStatusBadge').classList.add('show');
  
  const shortAddress = address.substring(0, 6) + '...' + address.substring(address.length - 4);
  document.getElementById('userAddressDisplay').textContent = shortAddress;
  document.getElementById('userAddressDisplay').title = address;
  
  document.getElementById('userScore').textContent = '80';
  document.getElementById('kycLevel').textContent = '1';
  
  showModal({
    type: 'success',
    title: '登录成功',
    content: `钱包地址类型：${addressType}
钱包地址：${shortAddress}

欢迎使用易渠SafePay担保交易平台`,
    buttons: [
      { text: '开始使用', type: 'primary' }
    ]
  });
}

// 重新登入功能
function handleReset() {
  isLoggedIn = false;
  currentUserAddress = '';
  
  const addressInput = document.getElementById('walletAddress');
  addressInput.value = '';
  addressInput.disabled = false;
  
  document.getElementById('loginStatusBadge').classList.remove('show');
  document.getElementById('userAddressDisplay').textContent = '未登录';
  document.getElementById('userAddressDisplay').title = '';
  document.getElementById('userScore').textContent = '--';
  document.getElementById('kycLevel').textContent = '-';
  
  addressInput.focus();
  
  showToast('已退出登录', 'info');
}

// 角色选择
function selectRole(role, element) {
  currentRole = role;
  document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('selected'));
  element.classList.add('selected');
  updateRiskAssessment();
}

// 地址检查
function checkAddress(address) {
  if (!address || address.length < 20) return;
  
  if (!isValidWalletAddress(address)) {
    document.getElementById('addressWarning').innerHTML = 
      '⚠️ 无效的钱包地址格式！请输入正确的TRC-20、ERC-20或BEP-20地址';
    document.getElementById('addressWarning').style.display = 'block';
    document.getElementById('addressRisk').textContent = '格式错误';
    document.getElementById('addressRisk').style.color = 'var(--danger)';
    return;
  }
  
  setTimeout(() => {
    const riskyAddresses = ['TRX123', 'TRY456'];
    const isRisky = riskyAddresses.some(risky => address.includes(risky));
    
    if (isRisky) {
      document.getElementById('addressWarning').innerHTML = 
        '⚠️ 该地址存在风险记录';
      document.getElementById('addressWarning').style.display = 'block';
      document.getElementById('addressRisk').textContent = '⚠️ 高风险';
      document.getElementById('addressRisk').style.color = 'var(--danger)';
    } else {
      document.getElementById('addressWarning').style.display = 'none';
      document.getElementById('addressRisk').textContent = '✓ 安全';
      document.getElementById('addressRisk').style.color = 'var(--success)';
    }
    
    document.getElementById('counterpartyRep').textContent = '80 分';
    updateRiskAssessment();
  }, 1000);
}

// 更新风险评估
function updateRiskAssessment() {
  const amount = parseFloat(document.getElementById('amount').value) || 0;
  const transactionType = document.getElementById('transactionType').value;
  
  let score = 25;
  
  if (amount > 10000) {
    score += 30;
    document.getElementById('amountRisk').textContent = '⚠️ 大额';
  } else if (amount > 5000) {
    score += 15;
    document.getElementById('amountRisk').textContent = '中等';
  } else {
    document.getElementById('amountRisk').textContent = '正常';
  }
  
  if (transactionType === 'digital') {
    score += 10;
  }
  
  riskScore = Math.min(100, score);
  document.getElementById('riskScore').textContent = riskScore;
  
  const riskLevel = document.getElementById('riskLevel');
  if (riskScore < 40) {
    riskLevel.textContent = '低风险';
    riskLevel.className = 'risk-level risk-low';
  } else if (riskScore < 70) {
    riskLevel.textContent = '中风险';
    riskLevel.className = 'risk-level risk-medium';
  } else {
    riskLevel.textContent = '高风险';
    riskLevel.className = 'risk-level risk-high';
  }
  
  updateFees();
}

// 更新费用
function updateFees() {
  const amount = parseFloat(document.getElementById('amount').value) || 0;
  const network = document.getElementById('network').value;
  
  let serviceFeeRate = riskScore < 40 ? 0.005 : riskScore < 70 ? 0.007 : 0.01;
  const serviceFee = amount * serviceFeeRate;
  
  const networkFees = {
    'TRC20': 1,
    'ERC20': 5,
    'BEP20': 0.5
  };
  const networkFee = networkFees[network] || 1;
  
  const deposit = amount === 0 ? 0 : (riskScore > 70 ? amount * 0.05 : 5);
  
  const totalAmount = amount + serviceFee + networkFee + deposit;
  
  document.getElementById('feeAmount').textContent = amount.toFixed(2) + ' USDT';
  document.getElementById('feeService').textContent = serviceFee.toFixed(2) + ' USDT';
  document.getElementById('feeNetwork').textContent = networkFee.toFixed(2) + ' USDT';
  document.getElementById('feeDeposit').textContent = deposit.toFixed(2) + ' USDT';
  document.getElementById('feeTotal').textContent = totalAmount.toFixed(2) + ' USDT';
}

// 保存草稿
function saveDraft() {
  if (!isLoggedIn) {
    showModal({
      type: 'warning',
      title: '请先登录',
      content: '请先登录钱包地址后再保存草稿',
      buttons: [
        { 
          text: '去登录', 
          type: 'primary',
          action: () => {
            document.getElementById('walletAddress').focus();
          }
        }
      ]
    });
    return;
  }
  
  const formData = {
    role: currentRole,
    counterpartyAddress: document.getElementById('counterpartyAddress').value,
    amount: document.getElementById('amount').value,
    network: document.getElementById('network').value,
    escrowPeriod: document.getElementById('escrowPeriod').value,
    transactionType: document.getElementById('transactionType').value,
    description: document.getElementById('description').value,
    userAddress: currentUserAddress
  };
  
  localStorage.setItem('escrowDraft', JSON.stringify(formData));
  showToast('草稿已保存', 'success');
}

// 提交表单
function handleFormSubmit(e) {
  e.preventDefault();
  
  if (!isLoggedIn) {
    showModal({
      type: 'warning',
      title: '请先登录',
      content: '请先登录钱包地址后再创建交易',
      buttons: [
        { 
          text: '去登录', 
          type: 'primary',
          action: () => {
            document.getElementById('walletAddress').focus();
          }
        }
      ]
    });
    return;
  }
  
  const counterpartyAddress = document.getElementById('counterpartyAddress').value.trim();
  if (!counterpartyAddress) {
    showModal({
      type: 'error',
      title: '请输入对方钱包地址',
      content: '对方钱包地址是必填项',
      buttons: [
        { 
          text: '确定', 
          type: 'primary',
          action: () => {
            document.getElementById('counterpartyAddress').focus();
          }
        }
      ]
    });
    return;
  }
  
  if (!isValidWalletAddress(counterpartyAddress)) {
    showModal({
      type: 'error',
      title: '对方钱包地址格式无效',
      content: '请确保地址格式正确：\n• TRC-20: T开头，34位\n• ERC-20/BEP-20: 0x开头，42位',
      buttons: [
        { 
          text: '重新输入', 
          type: 'primary',
          action: () => {
            document.getElementById('counterpartyAddress').focus();
          }
        }
      ]
    });
    return;
  }
  
  const amount = parseFloat(document.getElementById('amount').value);
  
  if (!amount || amount < 10) {
    showModal({
      type: 'error',
      title: '交易金额错误',
      content: '最小交易金额为 10 USDT',
      buttons: [
        { 
          text: '确定', 
          type: 'primary',
          action: () => {
            document.getElementById('amount').focus();
          }
        }
      ]
    });
    return;
  }
  
  const description = document.getElementById('description').value.trim();
  if (description.length < 30) {
    showModal({
      type: 'error',
      title: '描述过短',
      content: '交易描述至少需要30个字符，请详细描述交易内容',
      buttons: [
        { 
          text: '去完善', 
          type: 'primary',
          action: () => {
            document.getElementById('description').focus();
          }
        }
      ]
    });
    return;
  }
  
  if (riskScore > 70) {
    showModal({
      type: 'warning',
      icon: '⚠️',
      title: '风险提示',
      content: `当前交易风险评分：${riskScore}
建议谨慎交易。是否继续？`,
      buttons: [
        { text: '取消', type: 'secondary' },
        { 
          text: '继续交易', 
          type: 'warning',
          action: () => processTransaction()
        }
      ]
    });
    return;
  }
  
  processTransaction();
}

// 处理交易
function processTransaction() {
  const amount = parseFloat(document.getElementById('amount').value);
  const network = document.getElementById('network').value;
  const counterpartyAddress = document.getElementById('counterpartyAddress').value.trim();
  const description = document.getElementById('description').value.trim();
  
  let serviceFeeRate = riskScore < 40 ? 0.005 : riskScore < 70 ? 0.007 : 0.01;
  const serviceFee = amount * serviceFeeRate;
  
  const networkFees = {
    'TRC20': 1,
    'ERC20': 5,
    'BEP20': 0.5
  };
  const networkFee = networkFees[network] || 1;
  
  const deposit = riskScore > 70 ? amount * 0.05 : 5;
  const totalAmount = amount + serviceFee + networkFee + deposit;
  
  const txId = 'ESC' + Date.now().toString(36).toUpperCase();
  
  const transaction = {
    id: txId,
    role: currentRole,
    userAddress: currentUserAddress,
    userScore: 80,
    counterpartyAddress: counterpartyAddress,
    counterpartyScore: 80,
    amount: amount,
    serviceFee: serviceFee,
    networkFee: networkFee,
    deposit: deposit,
    totalAmount: totalAmount,
    network: network,
    escrowPeriod: document.getElementById('escrowPeriod').value,
    transactionType: document.getElementById('transactionType').value,
    description: description,
    riskScore: riskScore,
    status: 'CREATED',
    createdAt: new Date().toISOString()
  };
  
  console.log('保存的交易数据:', transaction);
  
  sessionStorage.setItem('currentTransaction', JSON.stringify(transaction));
  localStorage.setItem('latestTransaction', JSON.stringify(transaction));
  
  // 显示费用明细弹窗
  const feeDetails = `
    <div class="modal-info-section">
      <div class="modal-info-title">费用明细</div>
      <div class="modal-info-row">
        <span>交易金额</span>
        <span>${amount.toFixed(2)} USDT</span>
      </div>
      <div class="modal-info-row">
        <span>服务费</span>
        <span>${serviceFee.toFixed(2)} USDT</span>
      </div>
      <div class="modal-info-row">
        <span>网络费</span>
        <span>${networkFee.toFixed(2)} USDT</span>
      </div>
      <div class="modal-info-row">
        <span>保证金</span>
        <span>${deposit.toFixed(2)} USDT</span>
      </div>
      <div class="modal-info-row" style="border-top:1px solid var(--border);padding-top:8px;margin-top:8px;font-weight:600;">
        <span>总计</span>
        <span style="color:var(--primary);">${totalAmount.toFixed(2)} USDT</span>
      </div>
    </div>
  `;
  
  showModal({
    type: 'success',
    title: '交易创建成功',
    subtitle: `交易ID: ${txId}`,
    content: feeDetails,
    size: 'medium',
    buttons: [
      { 
        text: '前往支付', 
        type: 'primary',
        action: () => {
          window.location.href = './dbjy1.html';
        }
      }
    ]
  });
}

// 初始化实时交易
function initializeLiveTransactions() {
  const container = document.getElementById('liveTransactions');
  if (!container) return;
  
  // 初始交易数据
  const initialTransactions = [
    { address: 'TN8Rf5Pb...g8K', amount: 508.50, time: '刚刚' },
    { address: '0x742d35...bEb4', amount: 1212.00, time: '2分钟前' },
    { address: 'TWqkE8Vt...3nH', amount: 89.99, time: '5分钟前' }
  ];
  
  initialTransactions.forEach(tx => {
    const item = createTransactionItem(tx.address, tx.amount, tx.time);
    container.insertAdjacentHTML('beforeend', item);
  });
}

// 创建交易项
function createTransactionItem(address, amount, time) {
  return `
    <div class="transaction-item" style="animation: fadeIn 0.5s">
      <span class="transaction-status status-active"></span>
      <div class="transaction-info">
        <div class="transaction-id">${address}</div>
        <div><span class="transaction-amount">${amount.toFixed(2)} USDT</span> • ${time}</div>
      </div>
    </div>
  `;
}

// 生成随机地址
function generateRandomAddress() {
  const networks = ['TRC20', 'ERC20', 'BEP20'];
  const network = networks[Math.floor(Math.random() * networks.length)];
  
  if (network === 'TRC20') {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
    let middle = '';
    for (let i = 0; i < 4; i++) {
      middle += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    let end = '';
    for (let i = 0; i < 3; i++) {
      end += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return `T${middle}...${end}`;
  } else {
    const hex = '0123456789abcdef';
    let middle = '';
    for (let i = 0; i < 6; i++) {
      middle += hex.charAt(Math.floor(Math.random() * hex.length));
    }
    let end = '';
    for (let i = 0; i < 4; i++) {
      end += hex.charAt(Math.floor(Math.random() * hex.length));
    }
    return `0x${middle}...${end}`;
  }
}

// 生成随机金额
function generateRandomAmount() {
  const ranges = [
    { min: 50, max: 200, decimal: true },
    { min: 200, max: 500, decimal: true },
    { min: 500, max: 1000, decimal: false },
    { min: 1000, max: 3000, decimal: false },
    { min: 3000, max: 10000, decimal: false },
    { min: 100, max: 999, decimal: true },
    { min: 50, max: 499, decimal: true }
  ];
  
  const range = ranges[Math.floor(Math.random() * ranges.length)];
  const base = Math.floor(Math.random() * (range.max - range.min) + range.min);
  
  if (range.decimal && Math.random() > 0.3) {
    const decimal = Math.floor(Math.random() * 99);
    return base + decimal / 100;
  }
  
  return base;
}

// 实时交易更新
function startLiveUpdates() {
  setInterval(() => {
    const container = document.getElementById('liveTransactions');
    if (!container) return;
    
    const address = generateRandomAddress();
    const amount = generateRandomAmount();
    const newTransaction = createTransactionItem(address, amount, '刚刚');
    
    container.insertAdjacentHTML('afterbegin', newTransaction);
    
    // 更新时间
    const items = container.querySelectorAll('.transaction-item');
    items.forEach((item, index) => {
      if (index === 1) {
        item.querySelector('.transaction-info > div:last-child').innerHTML = 
          item.querySelector('.transaction-info > div:last-child').innerHTML.replace(/[^•]+$/, ' 2分钟前');
      } else if (index === 2) {
        item.querySelector('.transaction-info > div:last-child').innerHTML = 
          item.querySelector('.transaction-info > div:last-child').innerHTML.replace(/[^•]+$/, ' 5分钟前');
      } else if (index === 3) {
        item.querySelector('.transaction-info > div:last-child').innerHTML = 
          item.querySelector('.transaction-info > div:last-child').innerHTML.replace(/[^•]+$/, ' 8分钟前');
      }
    });
    
    while (container.children.length > 5) {
      container.removeChild(container.lastChild);
    }
  }, Math.random() * 5000 + 5000); // 5-10秒随机
}
</script>

</body>
</html>