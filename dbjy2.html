<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SafePay - æ™ºèƒ½äº¤æ˜“ç®¡ç†ä¸­å¿ƒ</title>
<style>
  :root{
    --bg-dark:#0a0e1a;
    --bg-card:#131825;
    --bg-hover:#1a2235;
    --border:#2a3245;
    --text-primary:#ffffff;
    --text-secondary:#94a3b8;
    --text-muted:#64748b;
    --primary:#3b82f6;
    --primary-dark:#2563eb;
    --success:#10b981;
    --warning:#f59e0b;
    --danger:#ef4444;
    --info:#06b6d4;
  }
  
  *{margin:0;padding:0;box-sizing:border-box}
  
  body{
    background:var(--bg-dark);
    background-image:radial-gradient(circle at 20% 80%, #1e40af15 0%, transparent 50%),
                     radial-gradient(circle at 80% 20%, #7c3aed15 0%, transparent 50%);
    font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
    color:var(--text-primary);
    min-height:100vh;
  }
  
  .container{
    max-width:1400px;
    margin:0 auto;
    padding:24px;
  }
  
  /* å¤´éƒ¨ */
  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:32px;
  }
  
  .breadcrumb{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
    color:var(--text-muted);
  }
  
  .breadcrumb a{
    color:var(--text-muted);
    text-decoration:none;
    transition:color 0.3s;
  }
  
  .breadcrumb a:hover{
    color:var(--primary);
  }
  
  .header-actions{
    display:flex;
    gap:12px;
  }
  
  .header-btn{
    padding:8px 16px;
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:10px;
    color:var(--text-primary);
    font-size:13px;
    cursor:pointer;
    transition:all 0.3s;
  }
  
  .header-btn:hover{
    background:var(--bg-hover);
    border-color:var(--primary);
  }
  
  /* ä¸»å¸ƒå±€ */
  .main-layout{
    display:grid;
    grid-template-columns:300px 1fr 380px;
    gap:24px;
  }
  
  .card{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:20px;
    padding:24px;
  }
  
  /* äº¤æ˜“çŠ¶æ€å¡ç‰‡ */
  .status-card{
    margin-bottom:24px;
  }
  
  .status-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
  }
  
  .status-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 16px;
    border-radius:24px;
    font-size:13px;
    font-weight:600;
  }
  
  .status-escrowed{
    background:rgba(59,130,246,0.1);
    color:var(--primary);
    border:1px solid rgba(59,130,246,0.3);
  }
  
  .status-delivering{
    background:rgba(6,182,212,0.1);
    color:var(--info);
    border:1px solid rgba(6,182,212,0.3);
  }
  
  .status-disputed{
    background:rgba(245,158,11,0.1);
    color:var(--warning);
    border:1px solid rgba(245,158,11,0.3);
  }
  
  .status-completed{
    background:rgba(16,185,129,0.1);
    color:var(--success);
    border:1px solid rgba(16,185,129,0.3);
  }
  
  /* æ—¶é—´çº¿ */
  .timeline{
    position:relative;
    padding-left:32px;
  }
  
  .timeline-line{
    position:absolute;
    left:12px;
    top:20px;
    bottom:0;
    width:2px;
    background:var(--border);
  }
  
  .timeline-item{
    position:relative;
    padding-bottom:24px;
  }
  
  .timeline-dot{
    position:absolute;
    left:-20px;
    top:4px;
    width:10px;
    height:10px;
    border-radius:50%;
    background:var(--bg-card);
    border:2px solid var(--border);
  }
  
  .timeline-item.completed .timeline-dot{
    background:var(--success);
    border-color:var(--success);
  }
  
  .timeline-item.active .timeline-dot{
    background:var(--primary);
    border-color:var(--primary);
    box-shadow:0 0 0 6px rgba(59,130,246,0.1);
  }
  
  .timeline-time{
    font-size:11px;
    color:var(--text-muted);
    margin-bottom:4px;
  }
  
  .timeline-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:4px;
  }
  
  .timeline-desc{
    font-size:12px;
    color:var(--text-secondary);
  }
  
  /* äº¤æ˜“ä¿¡æ¯ */
  .info-section{
    margin-bottom:24px;
  }
  
  .info-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:12px;
    color:var(--text-secondary);
  }
  
  .info-grid{
    display:grid;
    gap:12px;
  }
  
  .info-item{
    display:flex;
    justify-content:space-between;
    padding:10px;
    background:var(--bg-hover);
    border-radius:8px;
    font-size:13px;
  }
  
  .info-label{
    color:var(--text-muted);
  }
  
  .info-value{
    color:var(--text-primary);
    font-weight:500;
  }
  
  /* æ“ä½œé¢æ¿ */
  .action-panel{
    background:linear-gradient(135deg, rgba(59,130,246,0.05), rgba(16,185,129,0.05));
    border:1px solid rgba(59,130,246,0.2);
    border-radius:16px;
    padding:20px;
    margin-bottom:24px;
  }
  
  .action-title{
    font-size:16px;
    font-weight:600;
    margin-bottom:16px;
  }
  
  .action-buttons{
    display:grid;
    gap:12px;
  }
  
  .action-btn{
    padding:14px;
    border:none;
    border-radius:10px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
  }
  
  .action-btn:hover{
    transform:translateX(4px);
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
  }
  
  .btn-confirm{
    background:var(--success);
    color:white;
  }
  
  .btn-dispute{
    background:var(--warning);
    color:white;
  }
  
  .btn-cancel{
    background:var(--danger);
    color:white;
  }
  
  .btn-extend{
    background:var(--info);
    color:white;
  }
  
  /* èŠå¤©çª—å£ */
  .chat-container{
    display:flex;
    flex-direction:column;
    height:600px;
  }
  
  .chat-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding-bottom:16px;
    margin-bottom:16px;
    border-bottom:1px solid var(--border);
  }
  
  .chat-status{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:13px;
  }
  
  .online-dot{
    width:8px;
    height:8px;
    background:var(--success);
    border-radius:50%;
    animation:pulse 2s infinite;
  }
  
  .chat-messages{
    flex:1;
    overflow-y:auto;
    padding:16px;
    background:var(--bg-hover);
    border-radius:12px;
    margin-bottom:16px;
  }
  
  .message{
    margin-bottom:16px;
    display:flex;
    align-items:flex-start;
    gap:12px;
  }
  
  .message-avatar{
    width:32px;
    height:32px;
    background:var(--primary);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    font-weight:bold;
    flex-shrink:0;
  }
  
  .message-content{
    flex:1;
    max-width:70%;
  }
  
  .message-name{
    font-size:11px;
    color:var(--text-muted);
    margin-bottom:4px;
  }
  
  .message-text{
    background:var(--bg-card);
    padding:10px 14px;
    border-radius:12px;
    font-size:13px;
    line-height:1.5;
  }
  
  .message.self{
    flex-direction:row-reverse;
  }
  
  .message.self .message-content{
    align-items:flex-end;
  }
  
  .message.self .message-text{
    background:rgba(59,130,246,0.2);
  }
  
  .message-time{
    font-size:10px;
    color:var(--text-muted);
    margin-top:4px;
  }
  
  .system-message{
    text-align:center;
    margin:16px 0;
  }
  
  .system-text{
    display:inline-block;
    padding:6px 12px;
    background:rgba(245,158,11,0.1);
    border-radius:20px;
    font-size:11px;
    color:var(--warning);
  }
  
  .chat-input-area{
    display:flex;
    gap:12px;
  }
  
  .chat-input{
    flex:1;
    padding:12px;
    background:var(--bg-hover);
    border:1px solid var(--border);
    border-radius:10px;
    color:var(--text-primary);
    font-size:13px;
  }
  
  .send-btn{
    padding:12px 24px;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    transition:all 0.3s;
  }
  
  .send-btn:hover{
    background:var(--primary-dark);
  }
  
  /* äº‰è®®é¢æ¿ */
  .dispute-panel{
    background:rgba(245,158,11,0.05);
    border:1px solid rgba(245,158,11,0.2);
    border-radius:16px;
    padding:20px;
    margin-bottom:24px;
  }
  
  .dispute-header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:16px;
  }
  
  .dispute-icon{
    font-size:24px;
  }
  
  .dispute-title{
    font-size:16px;
    font-weight:600;
    color:var(--warning);
  }
  
  .dispute-info{
    font-size:13px;
    color:var(--text-secondary);
    line-height:1.6;
    margin-bottom:16px;
  }
  
  /* è¯æ®ä¸Šä¼  */
  .evidence-upload{
    background:var(--bg-hover);
    border:2px dashed var(--border);
    border-radius:12px;
    padding:20px;
    text-align:center;
    cursor:pointer;
    transition:all 0.3s;
    margin-bottom:16px;
  }
  
  .evidence-upload:hover{
    border-color:var(--primary);
    background:rgba(59,130,246,0.05);
  }
  
  .evidence-list{
    display:grid;
    gap:8px;
  }
  
  .evidence-item{
    display:flex;
    align-items:center;
    padding:12px;
    background:var(--bg-hover);
    border-radius:8px;
    font-size:13px;
  }
  
  .evidence-icon{
    margin-right:12px;
    font-size:20px;
  }
  
  .evidence-info{
    flex:1;
  }
  
  .evidence-name{
    font-weight:500;
    margin-bottom:2px;
  }
  
  .evidence-size{
    font-size:11px;
    color:var(--text-muted);
  }
  
  /* ä¿æŠ¤æœºåˆ¶æç¤º */
  .protection-notice{
    background:rgba(16,185,129,0.05);
    border:1px solid rgba(16,185,129,0.2);
    border-radius:12px;
    padding:16px;
    margin-bottom:24px;
  }
  
  .protection-header{
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:12px;
  }
  
  .protection-title{
    font-size:14px;
    font-weight:600;
    color:var(--success);
  }
  
  .protection-list{
    font-size:12px;
    color:var(--text-secondary);
    line-height:1.8;
    padding-left:24px;
  }
  
  /* è‡ªåŠ¨å¤„ç†å€’è®¡æ—¶ */
  .auto-process{
    background:var(--bg-hover);
    border-radius:12px;
    padding:16px;
    text-align:center;
  }
  
  .auto-process-title{
    font-size:13px;
    color:var(--text-secondary);
    margin-bottom:8px;
  }
  
  .auto-process-time{
    font-size:24px;
    font-weight:700;
    color:var(--primary);
    margin-bottom:8px;
  }
  
  .auto-process-action{
    font-size:12px;
    color:var(--text-muted);
  }
  
  /* äº¤æ˜“è¯¦æƒ…å¡ç‰‡ */
  .detail-card{
    background:var(--bg-hover);
    border-radius:12px;
    padding:16px;
    margin-bottom:16px;
  }
  
  .detail-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }
  
  .detail-title{
    font-size:14px;
    font-weight:600;
  }
  
  .detail-grid{
    display:grid;
    gap:8px;
  }
  
  .detail-row{
    display:flex;
    justify-content:space-between;
    font-size:12px;
    padding:6px 0;
    border-bottom:1px solid rgba(255,255,255,0.05);
  }
  
  .detail-row:last-child{
    border-bottom:none;
  }
  
  /* æ•°æ®åŠ è½½æç¤º */
  .data-alert{
    background:rgba(59,130,246,0.1);
    border:1px solid rgba(59,130,246,0.3);
    border-radius:12px;
    padding:12px;
    margin-bottom:16px;
    font-size:13px;
    color:var(--primary);
    display:none;
  }
  
  .data-alert.show{
    display:block;
  }
  
  /* å“åº”å¼ */
  @media (max-width:1200px){
    .main-layout{
      grid-template-columns:1fr;
    }
    .chat-container{
      height:400px;
    }
  }
  
  @media (max-width:640px){
    .header{
      flex-direction:column;
      gap:16px;
    }
    .action-buttons{
      grid-template-columns:1fr;
    }
  }
</style>
</head>
<body>
<div class="container">
  <!-- æ•°æ®æ¥æ”¶æç¤º -->
  <div class="data-alert" id="dataAlert">
    âœ… å·²æˆåŠŸæ¥æ”¶æ”¯ä»˜éªŒè¯æ•°æ®ï¼Œäº¤æ˜“å·²è¿›å…¥æ‰˜ç®¡é˜¶æ®µ
  </div>

  <!-- å¤´éƒ¨ -->
  <div class="header">
    <div class="breadcrumb">
      <a href="/">é¦–é¡µ</a>
      <span>/</span>
      <a href="/transactions">æˆ‘çš„äº¤æ˜“</a>
      <span>/</span>
      <span id="transactionIdBreadcrumb">ESC2025012014305678</span>
    </div>
    <div class="header-actions">
      <button class="header-btn">ğŸ“Š æŸ¥çœ‹æŠ¥å‘Š</button>
      <button class="header-btn">ğŸ“¥ ä¸‹è½½å‡­è¯</button>
      <button class="header-btn">ğŸ”— åˆ†äº«äº¤æ˜“</button>
      <button class="header-btn">â“ è·å–å¸®åŠ©</button>
    </div>
  </div>
  
  <div class="main-layout">
    <!-- å·¦ä¾§çŠ¶æ€æ  -->
    <div>
      <!-- äº¤æ˜“çŠ¶æ€ -->
      <div class="card status-card">
        <div class="status-header">
          <h3 style="font-size:16px;">äº¤æ˜“çŠ¶æ€</h3>
          <span class="status-badge status-escrowed">
            ğŸ”’ æ‰˜ç®¡ä¸­
          </span>
        </div>
        
        <!-- æ—¶é—´çº¿ -->
        <div class="timeline">
          <div class="timeline-line"></div>
          
          <div class="timeline-item completed">
            <div class="timeline-dot"></div>
            <div class="timeline-time" id="createTime">2025-01-20 14:30:56</div>
            <div class="timeline-title">åˆ›å»ºäº¤æ˜“</div>
            <div class="timeline-desc">ä¹°æ–¹å‘èµ·æ‹…ä¿äº¤æ˜“</div>
          </div>
          
          <div class="timeline-item completed">
            <div class="timeline-dot"></div>
            <div class="timeline-time" id="paymentTimeDisplay">2025-01-20 14:35:23</div>
            <div class="timeline-title">æ”¯ä»˜å®Œæˆ</div>
            <div class="timeline-desc" id="paymentAmountDisplay">1,234.56 USDT</div>
          </div>
          
          <div class="timeline-item completed">
            <div class="timeline-dot"></div>
            <div class="timeline-time" id="verifyTime">2025-01-20 14:36:45</div>
            <div class="timeline-title" id="verificationTitle">é“¾ä¸ŠéªŒè¯</div>
            <div class="timeline-desc" id="verificationDesc">19ä¸ªåŒºå—ç¡®è®¤</div>
          </div>
          
          <div class="timeline-item active">
            <div class="timeline-dot"></div>
            <div class="timeline-time">è¿›è¡Œä¸­...</div>
            <div class="timeline-title">èµ„é‡‘æ‰˜ç®¡</div>
            <div class="timeline-desc">ç­‰å¾…äº¤æ˜“å®Œæˆ</div>
          </div>
          
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-time">-</div>
            <div class="timeline-title">ç¡®è®¤æ”¶è´§</div>
            <div class="timeline-desc">ä¹°æ–¹ç¡®è®¤</div>
          </div>
          
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-time">-</div>
            <div class="timeline-title">èµ„é‡‘é‡Šæ”¾</div>
            <div class="timeline-desc">æ”¯ä»˜ç»™å–æ–¹</div>
          </div>
        </div>
      </div>
      
      <!-- è‡ªåŠ¨å¤„ç†å€’è®¡æ—¶ -->
      <div class="card">
        <div class="auto-process">
          <div class="auto-process-title">â±ï¸ è‡ªåŠ¨å¤„ç†å€’è®¡æ—¶</div>
          <div class="auto-process-time" id="autoReleaseTime">71:45:30</div>
          <div class="auto-process-action">è¶…æ—¶åå°†è‡ªåŠ¨é‡Šæ”¾ç»™å–æ–¹</div>
        </div>
      </div>
      
      <!-- ä¿æŠ¤æœºåˆ¶ -->
      <div class="protection-notice">
        <div class="protection-header">
          <span>ğŸ›¡ï¸</span>
          <span class="protection-title">ä¹°å®¶ä¿æŠ¤è®¡åˆ’</span>
        </div>
        <ul class="protection-list">
          <li>72å°æ—¶æ— æ¡ä»¶é€€æ¬¾ä¿éšœ</li>
          <li>å–æ–¹éœ€æä¾›å‘è´§è¯æ˜</li>
          <li>äº‰è®®ä¼˜å…ˆä¿æŠ¤ä¹°æ–¹æƒç›Š</li>
          <li>å¹³å°æ‰¿æ‹…ä»²è£è´£ä»»</li>
        </ul>
      </div>
    </div>
    
    <!-- ä¸­é—´ä¸»è¦å†…å®¹ -->
    <div>
      <!-- æ“ä½œé¢æ¿ -->
      <div class="action-panel">
        <h3 class="action-title">âš¡ äº¤æ˜“æ“ä½œ</h3>
        <div class="action-buttons">
          <button class="action-btn btn-confirm" onclick="confirmReceived()">
            âœ… ç¡®è®¤æ”¶è´§å¹¶é‡Šæ”¾èµ„é‡‘
          </button>
          <button class="action-btn btn-dispute" onclick="openDispute()">
            âš–ï¸ å‘èµ·äº‰è®®ç”³è¯·
          </button>
          <button class="action-btn btn-extend" onclick="extendPeriod()">
            â° å»¶é•¿æ‰˜ç®¡æœŸé™
          </button>
          <button class="action-btn btn-cancel" onclick="requestCancel()">
            âŒ ç”³è¯·å–æ¶ˆäº¤æ˜“
          </button>
        </div>
      </div>
      
      <!-- äº‰è®®é¢æ¿ï¼ˆåˆå§‹éšè—ï¼‰ -->
      <div class="dispute-panel" id="disputePanel" style="display:none;">
        <div class="dispute-header">
          <span class="dispute-icon">âš–ï¸</span>
          <span class="dispute-title">äº‰è®®å¤„ç†ä¸­å¿ƒ</span>
        </div>
        <div class="dispute-info">
          è¯·é€‰æ‹©äº‰è®®åŸå› å¹¶æä¾›ç›¸å…³è¯æ®ï¼Œå¹³å°å°†åœ¨24å°æ—¶å†…ä»‹å…¥å¤„ç†
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="font-size:13px;color:var(--text-secondary);margin-bottom:8px;display:block;">
            äº‰è®®åŸå› 
          </label>
          <select style="width:100%;padding:10px;background:var(--bg-card);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);">
            <option>æœªæ”¶åˆ°å•†å“</option>
            <option>å•†å“ä¸æè¿°ä¸ç¬¦</option>
            <option>å•†å“è´¨é‡é—®é¢˜</option>
            <option>å–æ–¹å¤±è”</option>
            <option>å…¶ä»–åŸå› </option>
          </select>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="font-size:13px;color:var(--text-secondary);margin-bottom:8px;display:block;">
            è¯¦ç»†è¯´æ˜
          </label>
          <textarea style="width:100%;min-height:80px;padding:10px;background:var(--bg-card);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);resize:vertical;" 
                    placeholder="è¯·è¯¦ç»†æè¿°é—®é¢˜..."></textarea>
        </div>
        
        <div class="evidence-upload" onclick="document.getElementById('evidenceFile').click()">
          <div style="font-size:24px;">ğŸ“</div>
          <div style="margin-top:8px;font-size:13px;">ç‚¹å‡»ä¸Šä¼ è¯æ®ææ–™</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">
            æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰æ ¼å¼
          </div>
          <input type="file" id="evidenceFile" style="display:none;" multiple>
        </div>
        
        <div class="evidence-list" id="evidenceList">
          <!-- è¯æ®åˆ—è¡¨åŠ¨æ€æ’å…¥ -->
        </div>
        
        <div style="display:flex;gap:12px;margin-top:16px;">
          <button style="flex:1;padding:12px;background:var(--bg-hover);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);cursor:pointer;" 
                  onclick="closeDispute()">
            å–æ¶ˆ
          </button>
          <button style="flex:1;padding:12px;background:var(--warning);border:none;border-radius:8px;color:white;font-weight:600;cursor:pointer;" 
                  onclick="submitDispute()">
            æäº¤äº‰è®®
          </button>
        </div>
      </div>
      
      <!-- èŠå¤©çª—å£ -->
      <div class="card chat-container">
        <div class="chat-header">
          <h3 style="font-size:16px;">ğŸ’¬ äº¤æ˜“æ²Ÿé€š</h3>
          <div class="chat-status">
            <span class="online-dot"></span>
            <span>å¯¹æ–¹åœ¨çº¿</span>
          </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
          <div class="system-message">
            <span class="system-text">äº¤æ˜“å·²åˆ›å»ºï¼ŒåŒæ–¹å¯å¼€å§‹æ²Ÿé€š</span>
          </div>
          
          <div class="system-message" id="verificationMessage" style="display:none;">
            <span class="system-text" id="verificationMessageText">æ”¯ä»˜å·²éªŒè¯ï¼Œèµ„é‡‘å·²è¿›å…¥æ‰˜ç®¡</span>
          </div>
          
          <div class="message">
            <div class="message-avatar">å–</div>
            <div class="message-content">
              <div class="message-name">å–æ–¹</div>
              <div class="message-text">æ‚¨å¥½ï¼Œæ„Ÿè°¢è´­ä¹°ï¼å•†å“å·²ç»å‡†å¤‡å¥½äº†ã€‚</div>
              <div class="message-time">14:40</div>
            </div>
          </div>
          
          <div class="message self">
            <div class="message-avatar">æˆ‘</div>
            <div class="message-content">
              <div class="message-name">æˆ‘</div>
              <div class="message-text">å¥½çš„ï¼Œè¯·æä¾›ä¸‹è½½é“¾æ¥å’Œå¯†ç </div>
              <div class="message-time">14:42</div>
            </div>
          </div>
          
          <div class="message">
            <div class="message-avatar">å–</div>
            <div class="message-content">
              <div class="message-name">å–æ–¹</div>
              <div class="message-text">
                é“¾æ¥ï¼šhttps://example.com/download<br>
                å¯†ç ï¼šABC123<br>
                è¯·åŠæ—¶ä¸‹è½½ï¼Œé“¾æ¥24å°æ—¶æœ‰æ•ˆ
              </div>
              <div class="message-time">14:43</div>
            </div>
          </div>
          
          <div class="system-message">
            <span class="system-text">ç³»ç»Ÿæç¤ºï¼šè¯·åœ¨å¹³å°å†…å®Œæˆäº¤æ˜“ï¼Œæ³¨æ„ä¿æŠ¤ä¸ªäººä¿¡æ¯</span>
          </div>
        </div>
        
        <div class="chat-input-area">
          <input type="text" class="chat-input" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯...">
          <button class="send-btn" onclick="sendMessage()">å‘é€</button>
        </div>
      </div>
    </div>
    
    <!-- å³ä¾§è¯¦æƒ…æ  -->
    <div>
      <!-- äº¤æ˜“è¯¦æƒ… -->
      <div class="card">
        <h3 style="font-size:16px;margin-bottom:20px;">ğŸ“‹ äº¤æ˜“è¯¦æƒ…</h3>
        
        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-title">åŸºæœ¬ä¿¡æ¯</span>
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span style="color:var(--text-muted);">äº¤æ˜“ç¼–å·</span>
              <span style="font-family:monospace;" id="transactionIdDetail">ESC20250120...</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">åˆ›å»ºæ—¶é—´</span>
              <span id="createTimeDetail">2025-01-20 14:30</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">äº¤æ˜“ç±»å‹</span>
              <span id="transactionTypeDetail">æ•°å­—å•†å“</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">æ‰˜ç®¡æœŸé™</span>
              <span>72å°æ—¶</span>
            </div>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-title">äº¤æ˜“åŒæ–¹</span>
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span style="color:var(--text-muted);">ä¹°æ–¹</span>
              <span style="font-family:monospace;">0x7f9...3d2</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">ä¹°æ–¹ä¿¡èª‰</span>
              <span style="color:var(--success);">â­ 98åˆ†</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">å–æ–¹</span>
              <span style="font-family:monospace;">TRY7...3aM5</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">å–æ–¹ä¿¡èª‰</span>
              <span style="color:var(--warning);">â­ 85åˆ†</span>
            </div>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-title">èµ„é‡‘ä¿¡æ¯</span>
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span style="color:var(--text-muted);">äº¤æ˜“é‡‘é¢</span>
              <span id="amountDetail">1,200.00 USDT</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">æœåŠ¡è´¹</span>
              <span id="serviceFeeDetail">12.00 USDT</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">ä¿è¯é‡‘</span>
              <span id="depositDetail">21.56 USDT</span>
            </div>
            <div class="detail-row" style="border-top:1px solid var(--border);padding-top:8px;margin-top:8px;">
              <span style="color:var(--text-muted);font-weight:600;">æ‰˜ç®¡æ€»é¢</span>
              <span style="color:var(--primary);font-weight:700;" id="totalAmountDetail">1,234.56 USDT</span>
            </div>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-header">
            <span class="detail-title">åŒºå—é“¾ä¿¡æ¯</span>
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span style="color:var(--text-muted);">ç½‘ç»œ</span>
              <span id="networkDetail">TRC-20</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">æ”¯ä»˜å“ˆå¸Œ</span>
              <span style="font-family:monospace;font-size:10px;" id="txHashDetail">0x7f9a...3d2e</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">æ‰˜ç®¡åˆçº¦</span>
              <span style="font-family:monospace;font-size:10px;">TRX8d...29dK2</span>
            </div>
            <div class="detail-row">
              <span style="color:var(--text-muted);">ç¡®è®¤æ•°</span>
              <span style="color:var(--success);" id="confirmationsDetail">19 ç¡®è®¤</span>
            </div>
            <div class="detail-row" id="verificationStatusRow" style="display:none;">
              <span style="color:var(--text-muted);">éªŒè¯çŠ¶æ€</span>
              <span style="color:var(--success);" id="verificationStatusDetail">âœ… å·²éªŒè¯</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// å…¨å±€å˜é‡
let disputeOpen = false;
let autoReleaseTimer;
let timeRemaining = 259530; // é»˜è®¤72å°æ—¶ï¼ˆç§’ï¼‰
let transactionData = {}; // å­˜å‚¨æ¥æ”¶çš„äº¤æ˜“æ•°æ®

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  // è¯»å–å¹¶å¤„ç†ä¼ é€’çš„æ•°æ®
  loadTransactionData();
  
  // åˆå§‹åŒ–å…¶ä»–åŠŸèƒ½
  startAutoReleaseTimer();
  setupWebSocket();
});

// è¯»å–äº¤æ˜“æ•°æ®
function loadTransactionData() {
  try {
    // ä»sessionStorageè¯»å–æ•°æ®
    const storedData = sessionStorage.getItem('currentTransaction');
    if (storedData) {
      transactionData = JSON.parse(storedData);
      console.log('æ¥æ”¶åˆ°çš„äº¤æ˜“æ•°æ®ï¼š', transactionData);
      
      // æ˜¾ç¤ºæ•°æ®æ¥æ”¶æç¤º
      const dataAlert = document.getElementById('dataAlert');
      dataAlert.classList.add('show');
      setTimeout(() => {
        dataAlert.classList.remove('show');
      }, 5000);
      
      // æ›´æ–°é¡µé¢æ˜¾ç¤º
      updatePageWithData();
    } else {
      console.log('æœªæ‰¾åˆ°äº¤æ˜“æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼');
    }
  } catch (error) {
    console.error('è¯»å–äº¤æ˜“æ•°æ®å¤±è´¥ï¼š', error);
  }
}

// ä½¿ç”¨æ¥æ”¶çš„æ•°æ®æ›´æ–°é¡µé¢
function updatePageWithData() {
  // æ›´æ–°äº¤æ˜“ID
  if (transactionData.id) {
    document.getElementById('transactionIdBreadcrumb').textContent = transactionData.id;
    document.getElementById('transactionIdDetail').textContent = transactionData.id.substring(0, 11) + '...';
  }
  
  // æ›´æ–°ç½‘ç»œä¿¡æ¯
  if (transactionData.network) {
    const networkMap = {
      'TRC20': 'TRC-20',
      'ERC20': 'ERC-20',
      'BEP20': 'BEP-20'
    };
    document.getElementById('networkDetail').textContent = networkMap[transactionData.network] || transactionData.network;
  }
  
  // æ›´æ–°é‡‘é¢ä¿¡æ¯
  if (transactionData.amount) {
    document.getElementById('amountDetail').textContent = transactionData.amount.toFixed(2) + ' USDT';
  }
  
  if (transactionData.serviceFee) {
    document.getElementById('serviceFeeDetail').textContent = transactionData.serviceFee.toFixed(2) + ' USDT';
  }
  
  if (transactionData.deposit) {
    document.getElementById('depositDetail').textContent = transactionData.deposit.toFixed(2) + ' USDT';
  }
  
  if (transactionData.totalAmount) {
    document.getElementById('totalAmountDetail').textContent = transactionData.totalAmount.toFixed(2) + ' USDT';
    document.getElementById('paymentAmountDisplay').textContent = transactionData.totalAmount.toFixed(2) + ' USDT';
  }
  
  // æ›´æ–°äº¤æ˜“å“ˆå¸Œ
  if (transactionData.txHash) {
    const hash = transactionData.txHash;
    const shortHash = hash.substring(0, 6) + '...' + hash.substring(hash.length - 4);
    document.getElementById('txHashDetail').textContent = shortHash;
  }
  
  // æ›´æ–°æ”¯ä»˜æ—¶é—´
  if (transactionData.paymentTime) {
    const paymentTime = new Date(transactionData.paymentTime);
    const formattedTime = paymentTime.toLocaleString('zh-CN', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    document.getElementById('paymentTimeDisplay').textContent = formattedTime;
  }
  
  // æ›´æ–°éªŒè¯çŠ¶æ€
  if (transactionData.verificationStatus) {
    const statusRow = document.getElementById('verificationStatusRow');
    statusRow.style.display = 'flex';
    
    let statusText = 'å¾…éªŒè¯';
    let statusColor = 'var(--text-muted)';
    
    switch(transactionData.verificationStatus) {
      case 'SUCCESS':
      case 'VERIFIED':
        statusText = 'âœ… å·²éªŒè¯';
        statusColor = 'var(--success)';
        // æ˜¾ç¤ºéªŒè¯æˆåŠŸæ¶ˆæ¯
        const verMsg = document.getElementById('verificationMessage');
        verMsg.style.display = 'block';
        document.getElementById('verificationMessageText').textContent = 
          'æ”¯ä»˜éªŒè¯æˆåŠŸï¼Œèµ„é‡‘å·²è¿›å…¥æ™ºèƒ½åˆçº¦æ‰˜ç®¡';
        break;
      case 'PENDING':
      case 'VERIFYING':
        statusText = 'â³ éªŒè¯ä¸­';
        statusColor = 'var(--warning)';
        break;
      case 'NOT_SUBMITTED':
        statusText = 'âš ï¸ æœªæäº¤';
        statusColor = 'var(--text-muted)';
        break;
    }
    
    const statusEl = document.getElementById('verificationStatusDetail');
    statusEl.textContent = statusText;
    statusEl.style.color = statusColor;
    
    // æ›´æ–°éªŒè¯æ—¶é—´çº¿ä¿¡æ¯
    if (transactionData.verificationStatus === 'SUCCESS' || transactionData.verificationStatus === 'VERIFIED') {
      document.getElementById('verificationTitle').textContent = 'æ”¯ä»˜éªŒè¯';
      document.getElementById('verificationDesc').textContent = 'éªŒè¯æˆåŠŸï¼Œèµ„é‡‘å·²æ‰˜ç®¡';
      
      // æ›´æ–°ç¡®è®¤æ•°
      const confirmations = transactionData.network === 'TRC20' ? 19 : 
                           transactionData.network === 'ERC20' ? 12 : 15;
      document.getElementById('confirmationsDetail').textContent = confirmations + ' ç¡®è®¤';
    }
  }
  
  // æ›´æ–°è‡ªåŠ¨é‡Šæ”¾å€’è®¡æ—¶ï¼ˆå¦‚æœæœ‰å‰©ä½™æ—¶é—´æ•°æ®ï¼‰
  if (transactionData.remainingTime) {
    // ä»æ”¯ä»˜é¡µé¢å¸¦æ¥çš„å€’è®¡æ—¶è½¬æ¢ä¸ºæ‰˜ç®¡å€’è®¡æ—¶ï¼ˆ72å°æ—¶å‡å»å·²ç”¨æ—¶é—´ï¼‰
    const usedTime = 1785 - transactionData.remainingTime; // åŸå§‹å€’è®¡æ—¶30åˆ†é’Ÿï¼ˆ1800ç§’ï¼‰
    timeRemaining = 259200 - usedTime; // 72å°æ—¶å‡å»å·²ç”¨æ—¶é—´
  }
  
  // æ›´æ–°äº¤æ˜“ç±»å‹
  if (transactionData.transactionType) {
    const typeMap = {
      'goods': 'å®ç‰©å•†å“',
      'digital': 'æ•°å­—å•†å“',
      'service': 'æœåŠ¡'
    };
    document.getElementById('transactionTypeDetail').textContent = 
      typeMap[transactionData.transactionType] || transactionData.transactionType;
  }
  
  // æ·»åŠ æ”¯ä»˜è¯æ˜æ ‡è®°ï¼ˆå¦‚æœæœ‰ï¼‰
  if (transactionData.hasProof) {
    const verDesc = document.getElementById('verificationDesc');
    verDesc.textContent += ' (å«æ”¯ä»˜å‡­è¯)';
  }
  
  // æ›´æ–°åˆ›å»ºæ—¶é—´
  const createTime = new Date();
  createTime.setMinutes(createTime.getMinutes() - 10); // å‡è®¾10åˆ†é’Ÿå‰åˆ›å»º
  document.getElementById('createTime').textContent = 
    createTime.toLocaleString('zh-CN', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
}

// è‡ªåŠ¨é‡Šæ”¾å€’è®¡æ—¶
function startAutoReleaseTimer() {
  autoReleaseTimer = setInterval(() => {
    if (timeRemaining <= 0) {
      clearInterval(autoReleaseTimer);
      handleAutoRelease();
      return;
    }
    
    timeRemaining--;
    const hours = Math.floor(timeRemaining / 3600);
    const minutes = Math.floor((timeRemaining % 3600) / 60);
    const seconds = timeRemaining % 60;
    
    document.querySelector('.auto-process-time').textContent = 
      `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // æé†’é€šçŸ¥
    if (timeRemaining === 86400) { // 24å°æ—¶
      showNotification('â° æé†’ï¼šæ‰˜ç®¡æœŸé™å‰©ä½™24å°æ—¶');
    } else if (timeRemaining === 3600) { // 1å°æ—¶
      showNotification('âš ï¸ è­¦å‘Šï¼šæ‰˜ç®¡æœŸé™å‰©ä½™1å°æ—¶ï¼Œè¯·å°½å¿«ç¡®è®¤');
    }
  }, 1000);
}

// è‡ªåŠ¨é‡Šæ”¾å¤„ç†
function handleAutoRelease() {
  if (confirm('æ‰˜ç®¡æœŸé™å·²åˆ°ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨é‡Šæ”¾èµ„é‡‘ç»™å–æ–¹ã€‚\n\nå¦‚æœ‰é—®é¢˜è¯·ç«‹å³å‘èµ·äº‰è®®ï¼')) {
    // æ›´æ–°çŠ¶æ€
    updateTransactionStatus('AUTO_RELEASED');
  }
}

// WebSocketè¿æ¥ï¼ˆæ¨¡æ‹Ÿå®æ—¶é€šä¿¡ï¼‰
function setupWebSocket() {
  // æ¨¡æ‹ŸWebSocketè¿æ¥
  console.log('WebSocket connected');
  
  // æ ¹æ®éªŒè¯çŠ¶æ€å‘é€ä¸åŒçš„ç³»ç»Ÿæ¶ˆæ¯
  if (transactionData.verificationStatus === 'SUCCESS' || transactionData.verificationStatus === 'VERIFIED') {
    setTimeout(() => {
      receiveMessage({
        type: 'system',
        text: 'å–æ–¹å·²æ”¶åˆ°æ”¯ä»˜ç¡®è®¤é€šçŸ¥ï¼Œè¯·ç­‰å¾…å‘è´§',
        time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
      });
    }, 5000);
  }
}

// å‘é€æ¶ˆæ¯
function sendMessage() {
  const input = document.getElementById('messageInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©çª—å£
  const messagesContainer = document.getElementById('chatMessages');
  const messageHTML = `
    <div class="message self">
      <div class="message-avatar">æˆ‘</div>
      <div class="message-content">
        <div class="message-name">æˆ‘</div>
        <div class="message-text">${message}</div>
        <div class="message-time">${new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}</div>
      </div>
    </div>
  `;
  
  messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  input.value = '';
  
  // æ¨¡æ‹Ÿè‡ªåŠ¨å›å¤
  if (message.includes('æ”¶åˆ°') || message.includes('ç¡®è®¤')) {
    setTimeout(() => {
      receiveMessage({
        type: 'seller',
        text: 'å¥½çš„ï¼Œè¯·ç¡®è®¤åå°½å¿«ç‚¹å‡»ç¡®è®¤æ”¶è´§æŒ‰é’®',
        time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
      });
    }, 2000);
  }
}

// æ¥æ”¶æ¶ˆæ¯
function receiveMessage(data) {
  const messagesContainer = document.getElementById('chatMessages');
  
  if (data.type === 'system') {
    const messageHTML = `
      <div class="system-message">
        <span class="system-text">${data.text}</span>
      </div>
    `;
    messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
  } else {
    const messageHTML = `
      <div class="message">
        <div class="message-avatar">å–</div>
        <div class="message-content">
          <div class="message-name">å–æ–¹</div>
          <div class="message-text">${data.text}</div>
          <div class="message-time">${data.time}</div>
        </div>
      </div>
    `;
    messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
  }
  
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// ç¡®è®¤æ”¶è´§
function confirmReceived() {
  if (confirm('ç¡®è®¤å·²æ”¶åˆ°å•†å“/æœåŠ¡ï¼Ÿ\n\nç¡®è®¤åèµ„é‡‘å°†ç«‹å³é‡Šæ”¾ç»™å–æ–¹ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
    // æ˜¾ç¤ºè¯„ä»·çª—å£
    showRatingDialog();
  }
}

// æ˜¾ç¤ºè¯„ä»·å¯¹è¯æ¡†
function showRatingDialog() {
  const dialog = `
    <div id="ratingDialog" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;">
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:20px;padding:32px;max-width:400px;width:90%;">
        <h3 style="text-align:center;margin-bottom:24px;">ä¸ºæœ¬æ¬¡äº¤æ˜“è¯„ä»·</h3>
        
        <div style="display:flex;justify-content:center;gap:8px;margin-bottom:20px;">
          ${[1,2,3,4,5].map(i => `<span onclick="setRating(${i})" style="font-size:32px;cursor:pointer;opacity:0.3;" id="star-${i}">â­</span>`).join('')}
        </div>
        
        <textarea style="width:100%;min-height:80px;padding:12px;background:var(--bg-hover);border:1px solid var(--border);border-radius:10px;color:var(--text-primary);margin-bottom:20px;" 
                  placeholder="åˆ†äº«æ‚¨çš„äº¤æ˜“ä½“éªŒ..."></textarea>
        
        <div style="display:flex;gap:12px;">
          <button style="flex:1;padding:12px;background:var(--bg-hover);border:1px solid var(--border);border-radius:10px;color:var(--text-primary);cursor:pointer;" 
                  onclick="closeRating()">
            å–æ¶ˆ
          </button>
          <button style="flex:1;padding:12px;background:var(--success);border:none;border-radius:10px;color:white;font-weight:600;cursor:pointer;" 
                  onclick="submitRating()">
            æäº¤è¯„ä»·
          </button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', dialog);
}

// è®¾ç½®è¯„åˆ†
function setRating(rating) {
  for (let i = 1; i <= 5; i++) {
    const star = document.getElementById(`star-${i}`);
    star.style.opacity = i <= rating ? '1' : '0.3';
  }
}

// å…³é—­è¯„ä»·
function closeRating() {
  const dialog = document.getElementById('ratingDialog');
  if (dialog) dialog.remove();
}

// æäº¤è¯„ä»·
function submitRating() {
  closeRating();
  
  // æ›´æ–°çŠ¶æ€
  updateTransactionStatus('COMPLETED');
  
  // æ›´æ–°UI
  document.querySelector('.status-badge').innerHTML = 'âœ… å·²å®Œæˆ';
  document.querySelector('.status-badge').className = 'status-badge status-completed';
  
  alert('äº¤æ˜“å®Œæˆï¼\n\nèµ„é‡‘å·²é‡Šæ”¾ç»™å–æ–¹ã€‚\næ„Ÿè°¢æ‚¨çš„è¯„ä»·ï¼');
}

// æ‰“å¼€äº‰è®®
function openDispute() {
  document.getElementById('disputePanel').style.display = 'block';
  disputeOpen = true;
}

// å…³é—­äº‰è®®
function closeDispute() {
  document.getElementById('disputePanel').style.display = 'none';
  disputeOpen = false;
}

// æäº¤äº‰è®®
function submitDispute() {
  if (confirm('ç¡®å®šè¦æäº¤äº‰è®®ç”³è¯·å—ï¼Ÿ\n\næäº¤åï¼Œèµ„é‡‘å°†ç»§ç»­å†»ç»“ï¼Œå¹³å°å°†åœ¨24å°æ—¶å†…ä»‹å…¥å¤„ç†ã€‚')) {
    // æ›´æ–°çŠ¶æ€
    updateTransactionStatus('DISPUTED');
    
    // æ›´æ–°UI
    document.querySelector('.status-badge').innerHTML = 'âš–ï¸ äº‰è®®ä¸­';
    document.querySelector('.status-badge').className = 'status-badge status-disputed';
    
    // å‘é€ç³»ç»Ÿæ¶ˆæ¯
    receiveMessage({
      type: 'system',
      text: 'äº‰è®®å·²æäº¤ï¼Œå®¢æœå°†åœ¨24å°æ—¶å†…ä»‹å…¥å¤„ç†',
      time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
    });
    
    closeDispute();
    
    alert('äº‰è®®ç”³è¯·å·²æäº¤ï¼\n\nå®¢æœå°†åœ¨24å°æ—¶å†…è”ç³»åŒæ–¹è¿›è¡Œå¤„ç†ã€‚');
  }
}

// å»¶é•¿æœŸé™
function extendPeriod() {
  const days = prompt('è¯·è¾“å…¥è¦å»¶é•¿çš„å¤©æ•°ï¼ˆ1-7ï¼‰ï¼š');
  if (days && !isNaN(days) && days >= 1 && days <= 7) {
    // å‘é€å»¶é•¿ç”³è¯·
    receiveMessage({
      type: 'system',
      text: `ä¹°æ–¹ç”³è¯·å»¶é•¿æ‰˜ç®¡æœŸé™ ${days} å¤©ï¼Œç­‰å¾…å–æ–¹ç¡®è®¤`,
      time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
    });
    
    alert('å»¶é•¿ç”³è¯·å·²å‘é€ç»™å¯¹æ–¹ï¼Œéœ€è¦å¯¹æ–¹åŒæ„åç”Ÿæ•ˆã€‚');
  }
}

// ç”³è¯·å–æ¶ˆ
function requestCancel() {
  if (confirm('ç¡®å®šè¦ç”³è¯·å–æ¶ˆäº¤æ˜“å—ï¼Ÿ\n\néœ€è¦å¯¹æ–¹åŒæ„æ‰èƒ½å–æ¶ˆã€‚')) {
    // å‘é€å–æ¶ˆç”³è¯·
    receiveMessage({
      type: 'system',
      text: 'ä¹°æ–¹ç”³è¯·å–æ¶ˆäº¤æ˜“ï¼Œç­‰å¾…å–æ–¹ç¡®è®¤',
      time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
    });
    
    alert('å–æ¶ˆç”³è¯·å·²å‘é€ï¼Œéœ€è¦å¯¹æ–¹åŒæ„åäº¤æ˜“æ‰ä¼šå–æ¶ˆã€‚');
  }
}

// æ›´æ–°äº¤æ˜“çŠ¶æ€
function updateTransactionStatus(status) {
  transactionData.status = status;
  transactionData.updatedAt = new Date().toISOString();
  
  // è®°å½•çŠ¶æ€å˜æ›´æ—¥å¿—
  if (!transactionData.statusHistory) {
    transactionData.statusHistory = [];
  }
  transactionData.statusHistory.push({
    status: status,
    timestamp: new Date().toISOString(),
    reason: 'User action'
  });
  
  sessionStorage.setItem('currentTransaction', JSON.stringify(transactionData));
}

// æ˜¾ç¤ºé€šçŸ¥
function showNotification(message) {
  // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨é€šçŸ¥APIæˆ–Toastç»„ä»¶
  console.log('Notification:', message);
  
  // æ·»åŠ åˆ°èŠå¤©çª—å£
  receiveMessage({
    type: 'system',
    text: message,
    time: new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})
  });
}

// è¯æ®ä¸Šä¼ 
document.getElementById('evidenceFile').addEventListener('change', function(e) {
  const files = e.target.files;
  const evidenceList = document.getElementById('evidenceList');
  
  for (let file of files) {
    const evidenceHTML = `
      <div class="evidence-item">
        <span class="evidence-icon">ğŸ“„</span>
        <div class="evidence-info">
          <div class="evidence-name">${file.name}</div>
          <div class="evidence-size">${(file.size / 1024).toFixed(2)} KB</div>
        </div>
      </div>
    `;
    evidenceList.insertAdjacentHTML('beforeend', evidenceHTML);
  }
});

// å›è½¦å‘é€æ¶ˆæ¯
document.getElementById('messageInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendMessage();
  }
});
</script>
</body>
</html>
